<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>💀 Skull Clicker™</title>
<!-- © 2025 hugochan117, Code are copyrighted by HugoChan117, 2025-->
  
<style>
  @import url('https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;600;700;800;900&display=swap');
  @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css');

  :root {
    --bg-color: #f5f5f5;
    --text-color: #333;
    --panel-bg: #e0e0e0;
    --border-color: #888;
    --header-bg: rgba(0,0,0,0.1);
    --button-bg: none;
    --button-hover-scale: 1.1;
    --upgrade-container-bg: #ff6b6b;
    --feature-container-bg: #4ecdc4;
    --autoclicker-container-bg: #ffe66d;
    --prestige-container-bg: #7bed9f;
    --save-container-bg: #70a1ff;
    --feature-button-bg: #2980b9;
    --feature-button-color: #fff;
    --save-button-bg: #444;
    --save-button-hover-bg: #666;
    --reset-button-bg: #e74c3c;
    --reset-button-hover-bg: #c0392b;
    --achievement-bg: #eee;
    --achievement-border: #ccc;
    --achievement-unlocked-border: #6c3;
    --achievement-unlocked-bg: #faffec;
    --achievement-popup-bg: #fffbe6;
    --achievement-popup-border: #6c3;
    --achievements-button-bg: #fff;
    --achievements-button-color: #222;
    --achievements-button-border: #888;
    --achievements-button-open-bg: #faffec;
    --achievements-button-open-border: #6c3;
    --alert-bg: #fff;
    --alert-color: #000;
    --click-animation-color: rgba(255, 215, 0, 0.7);
    --particle-size: 8px;
    --critical-color: #ff0000;
    --golden-color: #ffd700;
    --golden-time-color: #ffcc00;
    --notification-bg: rgba(0, 0, 0, 0.7);
    --notification-color: #fff;
    --progress-bar-bg: #ddd;
    --progress-bar-fill: #4CAF50;
    --tooltip-bg: rgba(0, 0, 0, 0.8);
    --tooltip-color: #fff;
    --rainbow-color-1: #ff0000;
    --rainbow-color-2: #ff7f00;
    --rainbow-color-3: #ffff00;
    --rainbow-color-4: #00ff00;
    --rainbow-color-5: #0000ff;
    --rainbow-color-6: #4b0082;
    --rainbow-color-7: #9400d3;
    --prestige-color: #9b59b6;
    --legendary-color: #f1c40f;
    --mythic-color: #e74c3c;
    --divine-color: #3498db;
    --angelic-color: #ecf0f1;
    --demonic-color: #c0392b;
    --ascended-color: #1abc9c;
    --cosmic-color: #8e44ad;
    --nebula-color: #2c3e50;
    --galactic-color: #16a085;
    --quantum-color: #27ae60;
    --time-color: #34495e;
    --space-color: #2980b9;
    --reality-color: #d35400;
    --power-color: #c0392b;
    --money-color: #f39c12;
    --dark-energy-color: #2c3e50;
    --light-energy-color: #f1c40f;
    --chaos-color: #e74c3c;
    --order-color: #3498db;
    --balance-color: #9b59b6;
    
    /* Tier colors */
    --tier-basic: #95a5a6;
    --tier-common: #2ecc71;
    --tier-uncommon: #3498db;
    --tier-rare: #9b59b6;
    --tier-epic: #f1c40f;
    --tier-legendary: #e74c3c;
    --tier-mythic: #8e44ad;
    --tier-divine: #ecf0f1;
    --tier-transcendent: #1abc9c;
    --tier-cosmic: #2c3e50;
    --tier-universal: #d35400;
    --tier-quantum: #27ae60;
    --tier-dimensional: #34495e;
    --tier-temporal: #2980b9;
    --tier-ethereal: #9b59b6;
    --tier-omega: #000000;
    
    /* Elemental colors */
    --elemental-fire: #e74c3c;
    --elemental-water: #3498db;
    --elemental-earth: #27ae60;
    --elemental-air: #ecf0f1;
    --elemental-lightning: #f1c40f;
    --elemental-ice: #a5d8ff;
    --elemental-nature: #2ecc71;
    --elemental-metal: #95a5a6;
    --elemental-light: #ffffff;
    --elemental-dark: #2c3e50;
    --elemental-void: #9b59b6;
    --elemental-arcane: #8e44ad;
    --elemental-holy: #f1c40f;
    --elemental-unholy: #c0392b;
    --elemental-chaos: #e74c3c;
    --elemental-order: #3498db;
    --elemental-time: #34495e;
    --elemental-space: #2980b9;
    --elemental-reality: #d35400;
    --elemental-power: #c0392b;
    --elemental-mind: #9b59b6;
    --elemental-soul: #1abc9c;
    --elemental-blood: #e74c3c;
    --elemental-bone: #ecf0f1;
    --elemental-spirit: #3498db;
    --elemental-magic: #8e44ad;
    --elemental-tech: #95a5a6;
    --elemental-psionic: #9b59b6;
    --elemental-gravity: #2c3e50;
    --elemental-nuclear: #27ae60;
    --elemental-sound: #3498db;
    --elemental-love: #e84393;
    --elemental-hate: #c0392b;
    --elemental-life: #2ecc71;
    --elemental-death: #2c3e50;
    --elemental-creation: #1abc9c;
    --elemental-destruction: #e74c3c;
    --elemental-infinity: #9b59b6;
    --elemental-eternity: #3498db;
    --elemental-dimension: #8e44ad;
    --elemental-quantum: #27ae60;
    --elemental-cosmic: #2c3e50;
    --elemental-galactic: #16a085;
    --elemental-universal: #9b59b6;
    --elemental-multiversal: #e74c3c;
    --elemental-omniversal: #3498db;
    --elemental-megaversal: #8e44ad;
    --elemental-hyperversal: #2c3e50;
    --elemental-outversal: #1abc9c;
    --elemental-transcendent: #f1c40f;
    --elemental-absolute: #ffffff;
    --elemental-ultimate: #e74c3c;
    --elemental-primordial: #9b59b6;
    --elemental-alpha: #3498db;
    --elemental-omega: #2c3e50;
  }

  body.dark-mode {
    --bg-color: #121212;
    --text-color: #eee;
    --panel-bg: #222;
    --border-color: #555;
    --header-bg: rgba(255,255,255,0.15);
    --button-bg: none;
    --upgrade-container-bg: #d63031;
    --feature-container-bg: #00b894;
    --autoclicker-container-bg: #fdcb6e;
    --prestige-container-bg: #00cec9;
    --save-container-bg: #0984e3;
    --feature-button-bg: #3a7bd5;
    --feature-button-color: #eee;
    --save-button-bg: #666;
    --save-button-hover-bg: #888;
    --reset-button-bg: #c0392b;
    --reset-button-hover-bg: #e74c3c;
    --achievement-bg: #333;
    --achievement-border: #666;
    --achievement-unlocked-border: #6c3;
    --achievement-unlocked-bg: #264d00;
    --achievement-popup-bg: #264d00;
    --achievement-popup-border: #6c3;
    --achievements-button-bg: #222;
    --achievements-button-color: #eee;
    --achievements-button-border: #555;
    --achievements-button-open-bg: #264d00;
    --achievements-button-open-border: #6c3;
    --alert-bg: #222;
    --alert-color: #eee;
    --click-animation-color: rgba(255, 215, 0, 0.5);
    --critical-color: #ff6b6b;
    --golden-color: #ffcc00;
    --golden-time-color: #ffd700;
    --notification-bg: rgba(255, 255, 255, 0.2);
    --notification-color: #fff;
    --progress-bar-bg: #444;
    --progress-bar-fill: #4CAF50;
    --tooltip-bg: rgba(255, 255, 255, 0.2);
    --tooltip-color: #fff;
  }

  * {
    font-family: 'Barlow', Arial, sans-serif !important;
  }

  body {
    font-family: 'Barlow', Arial, sans-serif;
    color: var(--text-color);
    background: linear-gradient(135deg, var(--bg-color), #f8f9fa);
    padding: 20px;
    text-align: center;
    transition: all 0.5s ease;
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
    background-image: 
      radial-gradient(circle at 25% 25%, rgba(255,255,255,0.1) 2px, transparent 2px),
      radial-gradient(circle at 75% 75%, rgba(0,0,0,0.05) 1px, transparent 1px);
    background-size: 40px 40px, 20px 20px;
    animation: bgShift 20s infinite linear;
  }

  @keyframes bgShift {
    0% { background-position: 0% 0%, 0% 0%; }
    100% { background-position: 100% 100%, 50% 50%; }
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 15px;
  }

  h1 {
    font-family: 'Barlow', Arial, sans-serif;
    font-size: 3em;
    margin-bottom: 10px;
    text-shadow: 0 4px 8px rgba(0,0,0,0.3);
    position: relative;
    background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57);
    background-size: 400% 400%;
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    animation: gradientShift 4s ease infinite;
    font-weight: 800;
  }

  @keyframes gradientShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }

  .title-decoration {
    position: absolute;
    top: -15px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 1.2em;
    opacity: 0.7;
  }

  #score {
    font-family: 'Barlow', Arial, sans-serif;
    font-size: 3.5em;
    margin: 20px 0;
    font-weight: 800;
    text-shadow: 0 4px 8px rgba(0,0,0,0.3);
    position: relative;
    background: linear-gradient(45deg, #f39c12, #e67e22);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }

  .score-decoration {
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.8em;
    opacity: 0.7;
  }

  #mainBtn {
    font-family: 'Barlow', Arial, sans-serif;
    font-size: 10em;
    padding: 20px;
    border: none;
    background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%);
    cursor: pointer;
    transition: all 0.3s ease;
    color: var(--text-color);
    margin: 20px auto;
    position: relative;
    user-select: none;
    outline: none;
    border-radius: 50%;
    width: 200px;
    height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 
      0 8px 32px rgba(0,0,0,0.3),
      inset 0 0 0 4px rgba(255,255,255,0.1);
    border: 4px solid rgba(0,0,0,0.1);
    filter: drop-shadow(0 0 20px rgba(255,255,255,0.3));
  }
  
  #mainBtn:hover {
    transform: scale(var(--button-hover-scale)) rotate(5deg);
    box-shadow: 
      0 12px 48px rgba(0,0,0,0.4),
      inset 0 0 0 4px rgba(255,255,255,0.2);
    filter: drop-shadow(0 0 30px rgba(255,255,255,0.5));
  }
  
  #mainBtn:active {
    transform: scale(0.95) rotate(-5deg);
    box-shadow: 
      0 4px 16px rgba(0,0,0,0.2),
      inset 0 0 0 4px rgba(255,255,255,0.3);
  }

  #statsDisplay {
    font-family: 'Barlow', Arial, sans-serif;
    margin-top: 20px;
    padding: 25px;
    background: linear-gradient(135deg, var(--panel-bg), rgba(255,255,255,0.1));
    border-radius: 15px;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
    text-align: left;
    color: var(--text-color);
    border: 2px solid var(--border-color);
    box-shadow: 
      0 8px 32px rgba(0,0,0,0.2),
      inset 0 1px 0 rgba(255,255,255,0.1);
    position: relative;
    overflow: hidden;
    backdrop-filter: blur(10px);
  }

  #statsDisplay::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 5px;
    background: linear-gradient(90deg, 
      var(--elemental-fire), 
      var(--elemental-water), 
      var(--elemental-earth), 
      var(--elemental-air),
      var(--elemental-lightning),
      var(--elemental-nature)
    );
    animation: rainbowFlow 3s linear infinite;
  }

  @keyframes rainbowFlow {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  /* Containers */
  .upgrade-container,
  .feature-container,
  .autoclicker-container,
  .prestige-container,
  .save-container,
  .achievements-container,
  .minigame-container,
  .research-container,
  .challenge-container,
  .event-container,
  .ascension-container,
  .cosmic-container,
  .prestige-shop-container,
  .cosmic-shop-container,
  .ascension-shop-container,
  .automation-container,
  .multiplier-container,
  .special-container {
    font-family: 'Barlow', Arial, sans-serif;
    margin-top: 30px;
    width: 100%;
    max-width: 950px;
    margin-left: auto;
    margin-right: auto;
    border-radius: 15px;
    border: 2px solid var(--border-color);
    box-shadow: 
      0 8px 32px rgba(0,0,0,0.2),
      inset 0 1px 0 rgba(255,255,255,0.1);
    position: relative;
    overflow: hidden;
    backdrop-filter: blur(5px);
    transition: all 0.3s ease;
  }

  .upgrade-container:hover,
  .feature-container:hover,
  .autoclicker-container:hover,
  .prestige-container:hover,
  .save-container:hover,
  .achievements-container:hover,
  .minigame-container:hover,
  .research-container:hover,
  .challenge-container:hover,
  .event-container:hover,
  .ascension-container:hover,
  .cosmic-container:hover,
  .prestige-shop-container:hover,
  .cosmic-shop-container:hover,
  .ascension-shop-container:hover,
  .automation-container:hover,
  .multiplier-container:hover,
  .special-container:hover {
    transform: translateY(-2px);
    box-shadow: 
      0 12px 48px rgba(0,0,0,0.3),
      inset 0 1px 0 rgba(255,255,255,0.2);
  }
  
  .upgrade-container { 
    background: linear-gradient(135deg, var(--upgrade-container-bg), rgba(255,107,107,0.8));
  }
  .feature-container { 
    background: linear-gradient(135deg, var(--feature-container-bg), rgba(78,205,196,0.8));
  }
  .autoclicker-container { 
    background: linear-gradient(135deg, var(--autoclicker-container-bg), rgba(255,230,109,0.8));
  }
  .prestige-container { 
    background: linear-gradient(135deg, var(--prestige-container-bg), rgba(123,237,159,0.8));
  }
  .save-container { 
    background: linear-gradient(135deg, var(--save-container-bg), rgba(112,161,255,0.8));
  }
  .automation-container {
    background: linear-gradient(135deg, #6c5ce7, rgba(108,92,231,0.8));
  }
  .multiplier-container {
    background: linear-gradient(135deg, #fd79a8, rgba(253,121,168,0.8));
  }
  .special-container {
    background: linear-gradient(135deg, #fdcb6e, rgba(253,203,110,0.8));
  }
  .achievements-container,
  .minigame-container,
  .research-container,
  .challenge-container,
  .event-container,
  .ascension-container,
  .cosmic-container,
  .prestige-shop-container,
  .cosmic-shop-container,
  .ascension-shop-container {
    background: linear-gradient(135deg, var(--panel-bg), rgba(255,255,255,0.1));
    box-sizing: border-box;
    padding-bottom: 10px;
    margin-bottom: 30px;
  }

  /* Headers */
  .upgrade-header,
  .feature-header,
  .autoclicker-header,
  .prestige-header,
  .save-header,
  .achievements-header,
  .minigame-header,
  .research-header,
  .challenge-header,
  .event-header,
  .ascension-header,
  .cosmic-header,
  .prestige-shop-header,
  .cosmic-shop-header,
  .ascension-shop-header,
  .automation-header,
  .multiplier-header,
  .special-header {
    font-family: 'Barlow', Arial, sans-serif;
    background: linear-gradient(135deg, var(--header-bg), rgba(0,0,0,0.2));
    cursor: pointer;
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 1.4em;
    font-weight: 700;
    color: var(--text-color);
    border-radius: 15px 15px 0 0;
    user-select: none;
    transition: all 0.3s ease;
    position: relative;
    backdrop-filter: blur(10px);
  }
  
  .upgrade-header:hover,
  .feature-header:hover,
  .autoclicker-header:hover,
  .prestige-header:hover,
  .save-header:hover,
  .achievements-header:hover,
  .minigame-header:hover,
  .research-header:hover,
  .challenge-header:hover,
  .event-header:hover,
  .ascension-header:hover,
  .cosmic-header:hover,
  .prestige-shop-header:hover,
  .cosmic-shop-header:hover,
  .ascension-shop-header:hover,
  .automation-header:hover,
  .multiplier-header:hover,
  .special-header:hover {
    background: linear-gradient(135deg, var(--header-bg), rgba(255,255,255,0.2));
    transform: translateY(-1px);
  }

  /* Content (collapsed by default except Save & Load) */
#upgradesContent,
#featuresContent,
#autoclickerContent,
#prestigeContent,
#achievementsContent,
#minigameContent,
#researchContent,
#challengeContent,
#eventContent,
#ascensionContent,
#cosmicContent,
#prestigeShopContent,
#cosmicShopContent,
#ascensionShopContent,
#automationContent,
#multiplierContent,
#specialContent {
  font-family: 'Barlow', Arial, sans-serif;
  display: none;
  padding: 25px;
  text-align: left;
  color: var(--text-color);
  background: rgba(255,255,255,0.05);
}

/* Fix for content areas that should use the correct class names */
.upgrade-content,
.feature-content,
.autoclicker-content,
.prestige-content,
.save-content,
.achievements-content,
.minigame-content,
.research-content,
.challenge-content,
.event-content,
.ascension-content,
.cosmic-content,
.prestige-shop-content,
.cosmic-shop-content,
.ascension-shop-content,
.automation-content,
.multiplier-content,
.special-content {
  font-family: 'Barlow', Arial, sans-serif;
  display: none;
  padding: 25px;
  text-align: left;
  color: var(--text-color);
  background: rgba(255,255,255,0.05);
}

#saveContent {
  font-family: 'Barlow', Arial, sans-serif;
  display: block;
  padding: 25px;
  text-align: center;
  color: var(--text-color);
  background: rgba(255,255,255,0.05);
}

  /* Upgrade grid */
  .upgrade-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 20px;
  }
  
  @media(max-width: 768px) {
    .upgrade-grid {
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
  }
  
  @media(max-width: 480px) {
    .upgrade-grid {
      grid-template-columns: 1fr;
      gap: 10px;
    }
  }

  /* Upgrade buttons with tier colors */
  .upgrade.small {
    font-family: 'Barlow', Arial, sans-serif;
    border-radius: 12px;
    border: none;
    color: #fff;
    font-weight: 700;
    cursor: pointer;
    padding: 20px 15px;
    font-size: 1.1em;
    transition: all 0.3s ease;
    box-shadow: 
      0 4px 16px rgba(0,0,0,0.3),
      inset 0 1px 0 rgba(255,255,255,0.2);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100px;
    text-align: center;
    position: relative;
    overflow: hidden;
    border: 2px solid rgba(255,255,255,0.3);
    backdrop-filter: blur(5px);
  }

  .upgrade.small.locked {
    opacity: 0.3;
    cursor: not-allowed;
    filter: grayscale(100%);
  }

  .upgrade.small::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s;
  }

  .upgrade.small:hover::before {
    left: 100%;
  }
  
  .upgrade.small:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 
      0 8px 32px rgba(0,0,0,0.4),
      inset 0 1px 0 rgba(255,255,255,0.3);
    filter: brightness(1.2);
  }
  
  .upgrade.small:active {
    transform: translateY(2px) scale(0.98);
    box-shadow: 
      0 2px 8px rgba(0,0,0,0.2),
      inset 0 1px 0 rgba(255,255,255,0.1);
  }
  
  .upgrade.small .icon {
    font-size: 2em;
    margin-bottom: 8px;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  }
  
  .upgrade.small .cost {
    font-size: 0.9em;
    margin-top: 8px;
    opacity: 0.9;
    background: rgba(0,0,0,0.2);
    padding: 4px 8px;
    border-radius: 6px;
  }

  /* Tier-specific styles */
  .tier-basic { background: linear-gradient(135deg, var(--tier-basic), #7f8c8d); }
  .tier-common { background: linear-gradient(135deg, var(--tier-common), #27ae60); }
  .tier-uncommon { background: linear-gradient(135deg, var(--tier-uncommon), #2980b9); }
  .tier-rare { background: linear-gradient(135deg, var(--tier-rare), #8e44ad); }
  .tier-epic { background: linear-gradient(135deg, var(--tier-epic), #f39c12); animation: epic-glow 2s infinite; }
  .tier-legendary { background: linear-gradient(135deg, var(--tier-legendary), #c0392b); animation: legendary-glow 2s infinite; }
  .tier-mythic { background: linear-gradient(135deg, var(--tier-mythic), #7d3c98); animation: mythic-glow 2s infinite; }
  .tier-divine { background: linear-gradient(135deg, var(--tier-divine), #bdc3c7); animation: divine-glow 2s infinite; }
  .tier-transcendent { background: linear-gradient(135deg, var(--tier-transcendent), #16a085); animation: transcendent-glow 2s infinite; }
  .tier-cosmic { background: linear-gradient(135deg, var(--tier-cosmic), #34495e); animation: cosmic-glow 2s infinite; }
  .tier-universal { background: linear-gradient(135deg, var(--tier-universal), #e67e22); animation: universal-glow 2s infinite; }
  .tier-quantum { background: linear-gradient(135deg, var(--tier-quantum), #2ecc71); animation: quantum-glow 2s infinite; }
  .tier-dimensional { background: linear-gradient(135deg, var(--tier-dimensional), #2c3e50); animation: dimensional-glow 2s infinite; }
  .tier-temporal { background: linear-gradient(135deg, var(--tier-temporal), #3498db); animation: temporal-glow 2s infinite; }
  .tier-ethereal { background: linear-gradient(135deg, var(--tier-ethereal), #9b59b6); animation: ethereal-glow 2s infinite; }
  .tier-omega { background: linear-gradient(135deg, var(--tier-omega), #2c3e50); animation: omega-glow 2s infinite; }

  @keyframes epic-glow {
    0%, 100% { box-shadow: 0 4px 16px rgba(241, 196, 15, 0.3), inset 0 1px 0 rgba(255,255,255,0.2); }
    50% { box-shadow: 0 8px 32px rgba(241, 196, 15, 0.5), inset 0 1px 0 rgba(255,255,255,0.3); }
  }

  @keyframes legendary-glow {
    0%, 100% { box-shadow: 0 4px 16px rgba(231, 76, 60, 0.3), inset 0 1px 0 rgba(255,255,255,0.2); }
    50% { box-shadow: 0 8px 32px rgba(231, 76, 60, 0.6), inset 0 1px 0 rgba(255,255,255,0.3); }
  }

  @keyframes mythic-glow {
    0%, 100% { box-shadow: 0 4px 16px rgba(142, 68, 173, 0.3), inset 0 1px 0 rgba(255,255,255,0.2); }
    50% { box-shadow: 0 8px 32px rgba(142, 68, 173, 0.6), inset 0 1px 0 rgba(255,255,255,0.3); }
  }

  @keyframes divine-glow {
    0%, 100% { box-shadow: 0 4px 16px rgba(236, 240, 241, 0.3), inset 0 1px 0 rgba(255,255,255,0.2); }
    50% { box-shadow: 0 8px 32px rgba(236, 240, 241, 0.6), inset 0 1px 0 rgba(255,255,255,0.3); }
  }

  @keyframes transcendent-glow {
    0%, 100% { box-shadow: 0 4px 16px rgba(26, 188, 156, 0.3), inset 0 1px 0 rgba(255,255,255,0.2); }
    50% { box-shadow: 0 8px 32px rgba(26, 188, 156, 0.6), inset 0 1px 0 rgba(255,255,255,0.3); }
  }

  @keyframes cosmic-glow {
    0%, 100% { box-shadow: 0 4px 16px rgba(44, 62, 80, 0.3), inset 0 1px 0 rgba(255,255,255,0.2); }
    50% { box-shadow: 0 8px 32px rgba(44, 62, 80, 0.6), inset 0 1px 0 rgba(255,255,255,0.3); }
  }

  @keyframes universal-glow {
    0%, 100% { box-shadow: 0 4px 16px rgba(211, 84, 0, 0.3), inset 0 1px 0 rgba(255,255,255,0.2); }
    50% { box-shadow: 0 8px 32px rgba(211, 84, 0, 0.6), inset 0 1px 0 rgba(255,255,255,0.3); }
  }

  @keyframes quantum-glow {
    0%, 100% { box-shadow: 0 4px 16px rgba(46, 204, 113, 0.3), inset 0 1px 0 rgba(255,255,255,0.2); }
    50% { box-shadow: 0 8px 32px rgba(46, 204, 113, 0.6), inset 0 1px 0 rgba(255,255,255,0.3); }
  }

  @keyframes dimensional-glow {
    0%, 100% { box-shadow: 0 4px 16px rgba(44, 62, 80, 0.3), inset 0 1px 0 rgba(255,255,255,0.2); }
    50% { box-shadow: 0 8px 32px rgba(44, 62, 80, 0.6), inset 0 1px 0 rgba(255,255,255,0.3); }
  }

  @keyframes temporal-glow {
    0%, 100% { box-shadow: 0 4px 16px rgba(52, 152, 219, 0.3), inset 0 1px 0 rgba(255,255,255,0.2); }
    50% { box-shadow: 0 8px 32px rgba(52, 152, 219, 0.6), inset 0 1px 0 rgba(255,255,255,0.3); }
  }

  @keyframes ethereal-glow {
    0%, 100% { box-shadow: 0 4px 16px rgba(155, 89, 182, 0.3), inset 0 1px 0 rgba(255,255,255,0.2); }
    50% { box-shadow: 0 8px 32px rgba(155, 89, 182, 0.6), inset 0 1px 0 rgba(255,255,255,0.3); }
  }

  @keyframes omega-glow {
    0%, 100% { 
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.8), inset 0 1px 0 rgba(255,255,255,0.2);
      background: linear-gradient(135deg, #000000, #2c3e50);
    }
    25% { 
      box-shadow: 0 8px 32px rgba(255, 0, 0, 0.6), inset 0 1px 0 rgba(255,255,255,0.3);
      background: linear-gradient(135deg, #000000, #e74c3c);
    }
    50% { 
      box-shadow: 0 8px 32px rgba(0, 255, 0, 0.6), inset 0 1px 0 rgba(255,255,255,0.3);
      background: linear-gradient(135deg, #000000, #27ae60);
    }
    75% { 
      box-shadow: 0 8px 32px rgba(0, 0, 255, 0.6), inset 0 1px 0 rgba(255,255,255,0.3);
      background: linear-gradient(135deg, #000000, #3498db);
    }
  }

  /* Feature buttons */
  button.feature {
    font-family: 'Barlow', Arial, sans-serif;
    padding: 15px 25px;
    border: none;
    border-radius: 12px;
    background: linear-gradient(135deg, var(--feature-button-bg), #3a7bd5);
    color: var(--feature-button-color);
    font-weight: 700;
    cursor: pointer;
    margin: 15px 10px;
    transition: all 0.3s ease;
    width: 100%;
    max-width: 350px;
    box-shadow: 
      0 4px 16px rgba(0,0,0,0.3),
      inset 0 1px 0 rgba(255,255,255,0.2);
    display: flex;
    flex-direction: column;
    align-items: center;
    border: 2px solid rgba(255,255,255,0.2);
    backdrop-filter: blur(5px);
    position: relative;
    overflow: hidden;
  }

  button.feature::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s;
  }

  button.feature:hover::before {
    left: 100%;
  }
  
  button.feature:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 
      0 8px 32px rgba(0,0,0,0.4),
      inset 0 1px 0 rgba(255,255,255,0.3);
    filter: brightness(1.2);
  }
  
  button.feature:active {
    transform: translateY(2px) scale(0.98);
  }
  
  .feature-info {
    font-family: 'Barlow', Arial, sans-serif;
    margin: 15px 0;
    padding: 15px;
    background: linear-gradient(135deg, rgba(0,0,0,0.2), rgba(255,255,255,0.1));
    border-radius: 12px;
    font-size: 1em;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.1);
  }

  /* Autoclicker & Prestige buttons */
  #autoclickerBuyBtn, #prestigeBuyBtn, #ascensionBuyBtn, #cosmicBuyBtn {
    font-family: 'Barlow', Arial, sans-serif;
    display: block;
    margin: 20px auto 0 auto;
    padding: 15px 35px;
    border: none;
    border-radius: 12px;
    color: #fff;
    font-weight: 700;
    font-size: 1.2em;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 
      0 4px 16px rgba(0,0,0,0.3),
      inset 0 1px 0 rgba(255,255,255,0.2);
    border: 2px solid rgba(255,255,255,0.2);
    backdrop-filter: blur(5px);
    position: relative;
    overflow: hidden;
  }

  #autoclickerBuyBtn::before, 
  #prestigeBuyBtn::before, 
  #ascensionBuyBtn::before, 
  #cosmicBuyBtn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s;
  }

  #autoclickerBuyBtn:hover::before, 
  #prestigeBuyBtn:hover::before, 
  #ascensionBuyBtn:hover::before, 
  #cosmicBuyBtn:hover::before {
    left: 100%;
  }
  
  #autoclickerBuyBtn {
    background: linear-gradient(135deg, #6c3483, #8e44ad);
  }
  
  #autoclickerBuyBtn:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 
      0 8px 32px rgba(108, 52, 131, 0.4),
      inset 0 1px 0 rgba(255,255,255,0.3);
  }
  
  #autoclickerBuyBtn:active {
    transform: translateY(2px) scale(0.98);
  }
  
  #prestigeBuyBtn {
    background: linear-gradient(135deg, #b03a00, #e74c3c);
  }
  
  #prestigeBuyBtn:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 
      0 8px 32px rgba(176, 58, 0, 0.4),
      inset 0 1px 0 rgba(255,255,255,0.3);
  }
  
  #prestigeBuyBtn:active {
    transform: translateY(2px) scale(0.98);
  }

  #ascensionBuyBtn {
    background: linear-gradient(135deg, #1abc9c, #16a085);
  }
  
  #ascensionBuyBtn:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 
      0 8px 32px rgba(26, 188, 156, 0.4),
      inset 0 1px 0 rgba(255,255,255,0.3);
  }
  
  #ascensionBuyBtn:active {
    transform: translateY(2px) scale(0.98);
  }

  #cosmicBuyBtn {
    background: linear-gradient(135deg, #9b59b6, #8e44ad);
  }
  
  #cosmicBuyBtn:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 
      0 8px 32px rgba(155, 89, 182, 0.4),
      inset 0 1px 0 rgba(255,255,255,0.3);
  }
  
  #cosmicBuyBtn:active {
    transform: translateY(2px) scale(0.98);
  }

  /* Save/Load Buttons */
  #saveBtn, #loadBtn, #resetBtn, #exportBtn, #importBtn {
    font-family: 'Barlow', Arial, sans-serif;
    padding: 15px 30px;
    font-size: 1.1em;
    border-radius: 12px;
    margin: 15px 8px;
    border: none;
    background: linear-gradient(135deg, var(--save-button-bg), #666);
    color: #fff;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 
      0 4px 16px rgba(0,0,0,0.3),
      inset 0 1px 0 rgba(255,255,255,0.2);
    border: 2px solid rgba(255,255,255,0.2);
    position: relative;
    overflow: hidden;
  }

  #saveBtn::before, #loadBtn::before, #resetBtn::before, #exportBtn::before, #importBtn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s;
  }

  #saveBtn:hover::before, #loadBtn:hover::before, #resetBtn:hover::before, #exportBtn:hover::before, #importBtn:hover::before {
    left: 100%;
  }
  
  #saveBtn:hover, #loadBtn:hover, #exportBtn:hover, #importBtn:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 
      0 8px 32px rgba(0,0,0,0.4),
      inset 0 1px 0 rgba(255,255,255,0.3);
    background: linear-gradient(135deg, var(--save-button-hover-bg), #888);
  }
  
  #saveBtn:active, #loadBtn:active, #exportBtn:active, #importBtn:active {
    transform: translateY(1px) scale(0.98);
  }
  
  #resetBtn {
    background: linear-gradient(135deg, var(--reset-button-bg), #c0392b);
  }
  
  #resetBtn:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 
      0 8px 32px rgba(231, 76, 60, 0.4),
      inset 0 1px 0 rgba(255,255,255,0.3);
    background: linear-gradient(135deg, var(--reset-button-hover-bg), #e74c3c);
  }
  
  #resetBtn:active {
    transform: translateY(1px) scale(0.98);
  }

  /* Achievements Button */
  #achievementsBtn {
    font-family: 'Barlow', Arial, sans-serif;
    margin-top: 30px;
    margin-bottom: 0;
    padding: 20px 40px;
    font-size: 1.2em;
    font-weight: 700;
    color: var(--achievements-button-color);
    background: linear-gradient(135deg, var(--achievements-button-bg), rgba(255,255,255,0.9));
    border: 2px solid var(--achievements-button-border);
    border-radius: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 
      0 8px 32px rgba(0,0,0,0.2),
      inset 0 1px 0 rgba(255,255,255,0.3);
    outline: none;
    position: relative;
    overflow: hidden;
    backdrop-filter: blur(10px);
  }

  #achievementsBtn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s;
  }

  #achievementsBtn:hover::before {
    left: 100%;
  }
  
  #achievementsBtn:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 
      0 12px 48px rgba(0,0,0,0.3),
      inset 0 1px 0 rgba(255,255,255,0.4);
    filter: brightness(1.1);
  }
  
  #achievementsBtn:active {
    transform: translateY(2px) scale(0.98);
  }
  
  #achievementsBtn.open {
    background: linear-gradient(135deg, var(--achievements-button-open-bg), rgba(250,255,236,0.9));
    border-color: var(--achievements-button-open-border);
    box-shadow: 
      0 8px 32px rgba(102, 187, 106, 0.3),
      inset 0 1px 0 rgba(255,255,255,0.3);
  }

  /* Achievements container */
  .achievements-container {
    border-radius: 15px;
    border: 2px solid var(--border-color);
    background: linear-gradient(135deg, var(--panel-bg), rgba(255,255,255,0.1));
    padding-bottom: 20px;
    margin-bottom: 30px;
    box-shadow: 
      0 8px 32px rgba(0,0,0,0.2),
      inset 0 1px 0 rgba(255,255,255,0.1);
  }

  /* Achievements list */
  .achievements-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    align-items: flex-start;
    justify-items: center;
    width: 100%;
    margin: 0 auto;
    padding: 0 20px;
  }
  
  @media (max-width: 600px) {
    .achievements-list {
      grid-template-columns: 1fr;
      gap: 15px;
    }
  }

  /* Single achievement */
  .achievement {
    font-family: 'Barlow', Arial, sans-serif;
    background: linear-gradient(135deg, var(--achievement-bg), rgba(255,255,255,0.1));
    border-radius: 12px;
    padding: 20px;
    width: 100%;
    box-shadow: 
      0 4px 16px rgba(0,0,0,0.2),
      inset 0 1px 0 rgba(255,255,255,0.1);
    border: 2px solid var(--achievement-border);
    position: relative;
    transition: all 0.3s ease;
    opacity: 0.7;
    filter: grayscale(70%);
    text-align: left;
    color: var(--text-color);
    display: flex;
    align-items: center;
    backdrop-filter: blur(5px);
  }
  
  .achievement.unlocked {
    border-color: var(--achievement-unlocked-border);
    background: linear-gradient(135deg, var(--achievement-unlocked-bg), rgba(250,255,236,0.9));
    opacity: 1;
    filter: none;
    animation: achievement-unlock 0.6s ease;
    transform: translateY(-3px);
    box-shadow: 
      0 8px 32px rgba(102, 187, 106, 0.3),
      inset 0 1px 0 rgba(255,255,255,0.2);
  }

  @keyframes achievement-unlock {
    0% { transform: scale(0.8) translateY(0); opacity: 0.7; }
    50% { transform: scale(1.1) translateY(-5px); opacity: 1; }
    100% { transform: scale(1) translateY(-3px); opacity: 1; }
  }
  
  .achievement .icon {
    font-size: 3em;
    margin-right: 20px;
    flex-shrink: 0;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  }
  
  .achievement-text {
    flex-grow: 1;
  }
  
  .achievement-title {
    font-family: 'Barlow', Arial, sans-serif;
    font-weight: 700;
    font-size: 1.2em;
    margin-bottom: 8px;
    color: var(--text-color);
  }
  
  .achievement-description {
    font-family: 'Barlow', Arial, sans-serif;
    font-size: 1em;
    opacity: 0.8;
    line-height: 1.4;
  }
  
  .achievement-progress {
    height: 6px;
    background: var(--progress-bar-bg);
    border-radius: 3px;
    margin-top: 12px;
    overflow: hidden;
    position: relative;
  }
  
  .achievement-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--progress-bar-fill), #66bb6a);
    width: 0%;
    transition: width 0.8s ease;
    position: relative;
    overflow: hidden;
  }

  .achievement-progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
      90deg,
      rgba(255,255,255,0) 0%,
      rgba(255,255,255,0.5) 50%,
      rgba(255,255,255,0) 100%
    );
    animation: progress-shine 2s infinite;
  }

  /* Achievement popup */
  #achievementPopup {
    font-family: 'Barlow', Arial, sans-serif;
    display: none;
    position: fixed;
    top: 50px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, var(--achievement-popup-bg), rgba(255,251,230,0.95));
    color: var(--text-color);
    border: 3px solid var(--achievement-popup-border);
    border-radius: 15px;
    box-shadow: 
      0 16px 64px rgba(0,0,0,0.4),
      inset 0 1px 0 rgba(255,255,255,0.3);
    padding: 25px 45px;
    z-index: 10000;
    font-size: 1.4em;
    min-width: 320px;
    max-width: 95vw;
    animation: achievement-popup 0.8s ease;
    text-align: center;
    backdrop-filter: blur(20px);
  }

  @keyframes achievement-popup {
    0% { 
      transform: translateX(-50%) scale(0.5) rotate(-10deg); 
      opacity: 0; 
    }
    50% { 
      transform: translateX(-50%) scale(1.1) rotate(5deg); 
      opacity: 1; 
    }
    100% { 
      transform: translateX(-50%) scale(1) rotate(0deg); 
      opacity: 1; 
    }
  }
  
  #achievementPopup .icon {
    font-size: 3em;
    margin-right: 20px;
    vertical-align: middle;
    filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
  }
  
  #achievementPopup .title {
    font-family: 'Barlow', Arial, sans-serif;
    font-weight: 800;
    margin-bottom: 8px;
    display: block;
    font-size: 1.3em;
    background: linear-gradient(45deg, #e74c3c, #f39c12, #f1c40f);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
  }
  
  #achievementPopup .description {
    font-family: 'Barlow', Arial, sans-serif;
    font-size: 1em;
    opacity: 0.9;
    line-height: 1.4;
  }

  /* Dark mode toggle button */
  #darkModeToggle {
    font-family: 'Barlow', Arial, sans-serif;
    position: fixed;
    top: 20px;
    right: 20px;
    background: linear-gradient(135deg, var(--achievements-button-bg), rgba(255,255,255,0.9));
    color: var(--achievements-button-color);
    border: 2px solid var(--achievements-button-border);
    border-radius: 15px;
    padding: 12px 22px;
    font-size: 1.1em;
    font-weight: 700;
    cursor: pointer;
    z-index: 11000;
    transition: all 0.3s ease;
    box-shadow: 
      0 4px 16px rgba(0,0,0,0.2),
      inset 0 1px 0 rgba(255,255,255,0.2);
    backdrop-filter: blur(10px);
  }
  
  #darkModeToggle:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 
      0 8px 32px rgba(0,0,0,0.3),
      inset 0 1px 0 rgba(255,255,255,0.3);
    filter: brightness(1.1);
  }
  
  #darkModeToggle:active {
    transform: translateY(1px) scale(0.98);
  }

  /* Click animation */
  .click-effect {
    position: absolute;
    pointer-events: none;
    width: var(--particle-size);
    height: var(--particle-size);
    background: radial-gradient(circle, var(--click-animation-color), transparent);
    border-radius: 50%;
    animation: click-animation 1.2s ease-out forwards;
    z-index: 1000;
  }
  
  @keyframes click-animation {
    0% {
      transform: translate(-50%, -50%) scale(0);
      opacity: 1;
    }
    100% {
      transform: translate(-50%, -50%) scale(15);
      opacity: 0;
    }
  }

  /* Critical hit effect */
  .critical-hit {
    font-family: 'Barlow', Arial, sans-serif;
    position: absolute;
    pointer-events: none;
    font-size: 2.5em;
    font-weight: 800;
    color: var(--critical-color);
    animation: critical-animation 1.5s ease-out forwards;
    z-index: 1000;
    text-shadow: 
      0 0 10px rgba(255,0,0,0.8),
      0 0 20px rgba(255,0,0,0.6),
      0 0 30px rgba(255,0,0,0.4);
    filter: drop-shadow(0 4px 8px rgba(0,0,0,0.5));
  }
  
  @keyframes critical-animation {
    0% {
      transform: translate(-50%, -50%) scale(0.3) rotate(-15deg);
      opacity: 1;
    }
    50% {
      transform: translate(-50%, -50%) scale(1.2) rotate(5deg);
      opacity: 1;
    }
    100% {
      transform: translate(-50%, -50%) scale(2.5) rotate(0deg);
      opacity: 0;
    }
  }

  /* Golden time indicator */
  .golden-time {
    font-family: 'Barlow', Arial, sans-serif;
    position: fixed;
    top: 20px;
    left: 20px;
    background: linear-gradient(135deg, var(--golden-time-color), #f39c12);
    color: #000;
    padding: 12px 20px;
    border-radius: 25px;
    font-weight: 700;
    font-size: 1.1em;
    z-index: 10000;
    box-shadow: 
      0 4px 16px rgba(255, 215, 0, 0.4),
      inset 0 1px 0 rgba(255,255,255,0.3);
    animation: golden-pulse 1.5s infinite;
    display: none;
    border: 2px solid rgba(255,255,255,0.5);
    backdrop-filter: blur(10px);
  }
  
  @keyframes golden-pulse {
    0%, 100% { 
      transform: scale(1); 
      box-shadow: 0 4px 16px rgba(255, 215, 0, 0.4), inset 0 1px 0 rgba(255,255,255,0.3);
    }
    50% { 
      transform: scale(1.05); 
      box-shadow: 0 8px 32px rgba(255, 215, 0, 0.6), inset 0 1px 0 rgba(255,255,255,0.4);
    }
  }

  /* Notification system */
  .notification {
    font-family: 'Barlow', Arial, sans-serif;
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, var(--notification-bg), rgba(0,0,0,0.9));
    color: var(--notification-color);
    padding: 15px 30px;
    border-radius: 12px;
    z-index: 10000;
    box-shadow: 
      0 8px 32px rgba(0,0,0,0.4),
      inset 0 1px 0 rgba(255,255,255,0.2);
    max-width: 90%;
    text-align: center;
    opacity: 0;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    border: 2px solid rgba(255,255,255,0.2);
    backdrop-filter: blur(20px);
    font-weight: 600;
  }
  
  .notification.show {
    opacity: 1;
    transform: translateX(-50%) translateY(-10px);
  }
  
  .notification .icon {
    margin-right: 15px;
    font-size: 1.8em;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  }

  /* Tooltip */
  .tooltip {
    font-family: 'Barlow', Arial, sans-serif;
    position: absolute;
    background: linear-gradient(135deg, var(--tooltip-bg), rgba(0,0,0,0.9));
    color: var(--tooltip-color);
    padding: 12px 18px;
    border-radius: 8px;
    font-size: 1em;
    pointer-events: none;
    z-index: 1000;
    opacity: 0;
    transition: all 0.3s ease;
    max-width: 280px;
    text-align: center;
    transform: translateY(15px);
    box-shadow: 
      0 8px 32px rgba(0,0,0,0.4),
      inset 0 1px 0 rgba(255,255,255,0.2);
    border: 1px solid rgba(255,255,255,0.2);
    backdrop-filter: blur(10px);
    font-weight: 600;
  }
  
  .tooltip.show {
    opacity: 1;
    transform: translateY(0);
  }

  /* Golden skull effect */
  .golden-skull {
    color: var(--golden-color);
    text-shadow: 
      0 0 10px rgba(255, 215, 0, 0.8),
      0 0 20px rgba(255, 215, 0, 0.6),
      0 0 30px rgba(255, 215, 0, 0.4);
    animation: golden-glow 1.5s infinite alternate;
    filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.8));
  }
  
  @keyframes golden-glow {
    from {
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
      filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.5));
    }
    to {
      text-shadow: 0 0 30px rgba(255, 215, 0, 0.9);
      filter: drop-shadow(0 0 50px rgba(255, 215, 0, 0.9));
    }
  }

  /* Rainbow text effect */
  .rainbow-text {
    background: linear-gradient(
      45deg,
      var(--rainbow-color-1),
      var(--rainbow-color-2),
      var(--rainbow-color-3),
      var(--rainbow-color-4),
      var(--rainbow-color-5),
      var(--rainbow-color-6),
      var(--rainbow-color-7)
    );
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    animation: rainbow-flow 3s linear infinite;
    background-size: 400% 400%;
  }
  
  @keyframes rainbow-flow {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }

  /* Particle effects */
  .particle {
    position: absolute;
    pointer-events: none;
    border-radius: 50%;
    animation: particle-animation 2.5s ease-out forwards;
    z-index: 1000;
  }
  
  @keyframes particle-animation {
    0% {
      transform: translate(-50%, -50%) scale(0);
      opacity: 1;
    }
    100% {
      transform: translate(var(--tx), var(--ty)) scale(1);
      opacity: 0;
    }
  }

  /* Floating text */
  .floating-text {
    font-family: 'Barlow', Arial, sans-serif;
    position: absolute;
    pointer-events: none;
    font-weight: 800;
    animation: floating-text-animation 2s ease-out forwards;
    z-index: 1000;
    text-shadow: 
      0 0 10px rgba(0,0,0,0.8),
      0 2px 4px rgba(0,0,0,0.5);
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  }
  
  @keyframes floating-text-animation {
    0% {
      transform: translate(-50%, -50%) scale(0.7);
      opacity: 1;
    }
    100% {
      transform: translate(-50%, -120px) scale(1.2);
      opacity: 0;
    }
  }

  /* Progress bar */
  .progress-container {
    width: 100%;
    height: 25px;
    background: linear-gradient(135deg, var(--progress-bar-bg), #bdc3c7);
    border-radius: 12px;
    margin: 15px 0;
    overflow: hidden;
    position: relative;
    box-shadow: 
      inset 0 2px 4px rgba(0,0,0,0.2),
      0 1px 0 rgba(255,255,255,0.2);
  }
  
  .progress-fill {
    height: 100%;
    background: linear-gradient(135deg, var(--progress-bar-fill), #4CAF50, #66bb6a);
    width: 0%;
    transition: width 0.5s ease;
    position: relative;
    overflow: hidden;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.3);
  }
  
  .progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
      90deg,
      rgba(255,255,255,0) 0%,
      rgba(255,255,255,0.4) 50%,
      rgba(255,255,255,0) 100%
    );
    animation: progress-shine 2s infinite;
  }
  
  @keyframes progress-shine {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }
  
  .progress-text {
    font-family: 'Barlow', Arial, sans-serif;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-weight: 700;
    font-size: 0.9em;
    text-shadow: 0 0 6px rgba(0,0,0,0.8);
    z-index: 2;
  }

  /* Minigame styles */
  .minigame-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 20px;
    padding: 20px;
  }
  
  .minigame-card {
    font-family: 'Barlow', Arial, sans-serif;
    background: linear-gradient(135deg, rgba(0,0,0,0.1), rgba(255,255,255,0.1));
    border-radius: 12px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    border: 2px solid rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    box-shadow: 
      0 4px 16px rgba(0,0,0,0.2),
      inset 0 1px 0 rgba(255,255,255,0.1);
  }
  
  .minigame-card:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 
      0 8px 32px rgba(0,0,0,0.3),
      inset 0 1px 0 rgba(255,255,255,0.2);
    background: linear-gradient(135deg, rgba(0,0,0,0.2), rgba(255,255,255,0.2));
  }
  
  .minigame-card:active {
    transform: translateY(2px) scale(0.98);
  }
  
  .minigame-card .icon {
    font-size: 2.5em;
    margin-bottom: 15px;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  }
  
  .minigame-card .title {
    font-weight: 700;
    margin-bottom: 8px;
    font-size: 1.1em;
  }
  
  .minigame-card .description {
    font-size: 0.9em;
    opacity: 0.8;
    line-height: 1.4;
  }

  /* Research styles */
  .research-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
    padding: 20px;
  }
  
  .research-card {
    font-family: 'Barlow', Arial, sans-serif;
    background: linear-gradient(135deg, rgba(0,0,0,0.1), rgba(255,255,255,0.1));
    border-radius: 12px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    border: 2px solid rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    box-shadow: 
      0 4px 16px rgba(0,0,0,0.2),
      inset 0 1px 0 rgba(255,255,255,0.1);
  }
  
  .research-card:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 
      0 8px 32px rgba(0,0,0,0.3),
      inset 0 1px 0 rgba(255,255,255,0.2);
    background: linear-gradient(135deg, rgba(0,0,0,0.2), rgba(255,255,255,0.2));
  }
  
  .research-card:active {
    transform: translateY(2px) scale(0.98);
  }
  
  .research-card .icon {
    font-size: 2.5em;
    margin-bottom: 15px;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  }
  
  .research-card .title {
    font-weight: 700;
    margin-bottom: 8px;
    font-size: 1.1em;
  }
  
  .research-card .description {
    font-size: 0.9em;
    opacity: 0.8;
    margin-bottom: 15px;
    line-height: 1.4;
  }
  
  .research-card .cost {
    font-size: 1em;
    font-weight: 700;
    margin-top: 15px;
    color: var(--golden-color);
    text-shadow: 0 0 10px rgba(241, 196, 15, 0.5);
  }

  .research-card .unlock-info {
    font-size: 0.85em;
    margin-top: 10px;
    color: var(--elemental-arcane);
    font-weight: 600;
    background: rgba(142, 68, 173, 0.2);
    padding: 8px;
    border-radius: 8px;
    border: 1px solid rgba(142, 68, 173, 0.3);
  }

  /* Challenge styles */
  .challenge-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
    padding: 20px;
  }
  
  .challenge-card {
    font-family: 'Barlow', Arial, sans-serif;
    background: linear-gradient(135deg, rgba(0,0,0,0.1), rgba(255,255,255,0.1));
    border-radius: 12px;
    padding: 20px;
    transition: all 0.3s ease;
    text-align: center;
    border: 2px solid rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    box-shadow: 
      0 4px 16px rgba(0,0,0,0.2),
      inset 0 1px 0 rgba(255,255,255,0.1);
    cursor: pointer;
  }
  
  .challenge-card.active {
    border-color: var(--elemental-fire);
    background: linear-gradient(135deg, rgba(231, 76, 60, 0.2), rgba(255,255,255,0.1));
    box-shadow: 
      0 4px 16px rgba(231, 76, 60, 0.3),
      inset 0 1px 0 rgba(255,255,255,0.1);
  }
  
  .challenge-card.completed {
    border-color: var(--elemental-nature);
    background: linear-gradient(135deg, rgba(46, 204, 113, 0.2), rgba(255,255,255,0.1));
    box-shadow: 
      0 4px 16px rgba(46, 204, 113, 0.3),
      inset 0 1px 0 rgba(255,255,255,0.1);
  }

  .challenge-card:hover {
    transform: translateY(-3px) scale(1.02);
  }
  
  .challenge-card .icon {
    font-size: 2.5em;
    margin-bottom: 15px;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  }
  
  .challenge-card .title {
    font-weight: 700;
    margin-bottom: 8px;
    font-size: 1.1em;
  }
  
  .challenge-card .description {
    font-size: 0.9em;
    opacity: 0.8;
    margin-bottom: 15px;
    line-height: 1.4;
  }
  
  .challenge-card .reward {
    font-size: 1em;
    font-weight: 700;
    margin-top: 15px;
    color: var(--golden-color);
    text-shadow: 0 0 10px rgba(241, 196, 15, 0.5);
  }
  
  .challenge-card .progress {
    margin-top: 15px;
    height: 8px;
    background: var(--progress-bar-bg);
    border-radius: 4px;
    overflow: hidden;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
  }
  
  .challenge-card .progress-fill {
    height: 100%;
    background: linear-gradient(135deg, var(--progress-bar-fill), #66bb6a);
    width: 0%;
    transition: width 0.8s ease;
    position: relative;
    overflow: hidden;
  }

  .challenge-card .progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
      90deg,
      rgba(255,255,255,0) 0%,
      rgba(255,255,255,0.5) 50%,
      rgba(255,255,255,0) 100%
    );
    animation: progress-shine 2s infinite;
  }

  /* Event styles */
  .event-banner {
    font-family: 'Barlow', Arial, sans-serif;
    background: linear-gradient(135deg, var(--elemental-fire), var(--elemental-lightning), var(--golden-color));
    color: white;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    text-align: center;
    font-weight: 700;
    animation: event-pulse 2s infinite;
    box-shadow: 
      0 8px 32px rgba(0,0,0,0.3),
      inset 0 1px 0 rgba(255,255,255,0.2);
    border: 2px solid rgba(255,255,255,0.3);
    backdrop-filter: blur(10px);
  }
  
  @keyframes event-pulse {
    0%, 100% { 
      transform: scale(1); 
      box-shadow: 0 8px 32px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.2);
    }
    50% { 
      transform: scale(1.02); 
      box-shadow: 0 12px 48px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.3);
    }
  }
  
  .event-timer {
    font-family: 'Barlow', Arial, sans-serif;
    font-size: 1.3em;
    font-weight: 700;
    margin: 15px 0;
    color: var(--golden-color);
    text-shadow: 
      0 0 10px rgba(241, 196, 15, 0.8),
      0 2px 4px rgba(0,0,0,0.5);
  }
  
  .event-rewards {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 20px;
    flex-wrap: wrap;
  }
  
  .event-reward {
    font-family: 'Barlow', Arial, sans-serif;
    background: linear-gradient(135deg, rgba(255,255,255,0.3), rgba(255,255,255,0.1));
    border-radius: 12px;
    padding: 15px;
    text-align: center;
    min-width: 120px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
    box-shadow: 
      0 4px 16px rgba(0,0,0,0.2),
      inset 0 1px 0 rgba(255,255,255,0.3);
  }
  
  .event-reward .icon {
    font-size: 2em;
    margin-bottom: 8px;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  }
  
  .event-reward .amount {
    font-weight: 700;
    font-size: 1.1em;
  }

/* Add this to your CSS */
.shop-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 15px;
    padding: 20px;
}

.shop-item {
    background: linear-gradient(135deg, rgba(0,0,0,0.1), rgba(255,255,255,0.1));
    border-radius: 12px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    border: 2px solid rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 16px rgba(0,0,0,0.2);
    position: relative;
}

.shop-item:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
}

.shop-item.purchased {
    opacity: 0.5;
    cursor: not-allowed;
}

.shop-item.locked {
    opacity: 0.3;
    cursor: not-allowed;
    filter: grayscale(100%);
}

.shop-item .icon {
    font-size: 2.5em;
    margin-bottom: 15px;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
}

.shop-item .title {
    font-weight: 700;
    margin-bottom: 8px;
    font-size: 1.1em;
}

.shop-item .description {
    font-size: 0.9em;
    opacity: 0.8;
    margin-bottom: 15px;
    line-height: 1.4;
}

.shop-item .cost {
    font-size: 1em;
    font-weight: 700;
    margin-top: 15px;
}

.shop-item-purchased {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #27ae60;
    color: white;
    border-radius: 50%;
    width: 25px;
    height: 25px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8em;
}

  /* Shop styles */
  .prestige-shop-grid,
  .cosmic-shop-grid,
  .ascension-shop-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
    padding: 20px;
  }
  
  .prestige-shop-item,
  .cosmic-shop-item,
  .ascension-shop-item {
    font-family: 'Barlow', Arial, sans-serif;
    border-radius: 12px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    backdrop-filter: blur(10px);
    box-shadow: 
      0 4px 16px rgba(0,0,0,0.2),
      inset 0 1px 0 rgba(255,255,255,0.1);
    position: relative;
    overflow: hidden;
  }

  .prestige-shop-item::before,
  .cosmic-shop-item::before,
  .ascension-shop-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s;
  }

  .prestige-shop-item:hover::before,
  .cosmic-shop-item:hover::before,
  .ascension-shop-item:hover::before {
    left: 100%;
  }

  .prestige-shop-item {
    background: linear-gradient(135deg, rgba(155, 89, 182, 0.2), rgba(255,255,255,0.1));
    border: 2px solid rgba(155, 89, 182, 0.3);
  }

  .cosmic-shop-item {
    background: linear-gradient(135deg, rgba(142, 68, 173, 0.2), rgba(255,255,255,0.1));
    border: 2px solid rgba(142, 68, 173, 0.3);
  }

  .ascension-shop-item {
    background: linear-gradient(135deg, rgba(26, 188, 156, 0.2), rgba(255,255,255,0.1));
    border: 2px solid rgba(26, 188, 156, 0.3);
  }
  
  .prestige-shop-item:hover,
  .cosmic-shop-item:hover,
  .ascension-shop-item:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 
      0 8px 32px rgba(0,0,0,0.3),
      inset 0 1px 0 rgba(255,255,255,0.2);
  }
  
  .prestige-shop-item:active,
  .cosmic-shop-item:active,
  .ascension-shop-item:active {
    transform: translateY(2px) scale(0.98);
  }
  
  .prestige-shop-item .icon,
  .cosmic-shop-item .icon,
  .ascension-shop-item .icon {
    font-size: 2.5em;
    margin-bottom: 15px;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  }

  .prestige-shop-item .icon {
    color: var(--prestige-color);
  }

  .cosmic-shop-item .icon {
    color: var(--cosmic-color);
  }

  .ascension-shop-item .icon {
    color: var(--ascended-color);
  }
  
  .prestige-shop-item .title,
  .cosmic-shop-item .title,
  .ascension-shop-item .title {
    font-weight: 700;
    margin-bottom: 8px;
    font-size: 1.1em;
  }
  
  .prestige-shop-item .description,
  .cosmic-shop-item .description,
  .ascension-shop-item .description {
    font-size: 0.9em;
    opacity: 0.8;
    margin-bottom: 15px;
    line-height: 1.4;
  }
  
  .prestige-shop-item .cost,
  .cosmic-shop-item .cost,
  .ascension-shop-item .cost {
    font-size: 1em;
    font-weight: 700;
    margin-top: 15px;
  }

  .prestige-shop-item .cost {
    color: var(--prestige-color);
  }

  .cosmic-shop-item .cost {
    color: var(--cosmic-color);
  }

  .ascension-shop-item .cost {
    color: var(--ascended-color);
  }

  /* Badge styles */
  .badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 15px;
    font-size: 0.75em;
    font-weight: 700;
    margin-left: 8px;
    vertical-align: middle;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .badge-new {
    background: linear-gradient(135deg, var(--elemental-fire), #c0392b);
    color: white;
    animation: badge-pulse 2s infinite;
  }
  
  .badge-event {
    background: linear-gradient(135deg, var(--golden-color), #f39c12);
    color: black;
    animation: badge-pulse 2s infinite;
  }
  
  .badge-limited {
    background: linear-gradient(135deg, var(--elemental-lightning), #f39c12);
    color: black;
    animation: badge-pulse 2s infinite;
  }
  
  .badge-special {
    background: linear-gradient(135deg, var(--elemental-arcane), #7d3c98);
    color: white;
    animation: badge-pulse 2s infinite;
  }

  .badge-unlock {
    background: linear-gradient(135deg, var(--elemental-nature), #27ae60);
    color: white;
    animation: badge-pulse 2s infinite;
  }

  @keyframes badge-pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
  }

  /* Automation styles */
  .automation-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
    padding: 20px;
  }

  .automation-card {
    font-family: 'Barlow', Arial, sans-serif;
    background: linear-gradient(135deg, rgba(108, 92, 231, 0.2), rgba(255,255,255,0.1));
    border-radius: 12px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    border: 2px solid rgba(108, 92, 231, 0.3);
    backdrop-filter: blur(10px);
    box-shadow: 
      0 4px 16px rgba(0,0,0,0.2),
      inset 0 1px 0 rgba(255,255,255,0.1);
  }

  .automation-card:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 
      0 8px 32px rgba(0,0,0,0.3),
      inset 0 1px 0 rgba(255,255,255,0.2);
  }

  .automation-card .icon {
    font-size: 2.5em;
    margin-bottom: 15px;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
    color: #6c5ce7;
  }

  .automation-card .title {
    font-weight: 700;
    margin-bottom: 8px;
    font-size: 1.1em;
  }

  .automation-card .description {
    font-size: 0.9em;
    opacity: 0.8;
    margin-bottom: 15px;
    line-height: 1.4;
  }

  .automation-card .cost {
    font-size: 1em;
    font-weight: 700;
    margin-top: 15px;
    color: #6c5ce7;
  }

  /* Multiplier styles */
  .multiplier-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
    padding: 20px;
  }

  .multiplier-card {
    font-family: 'Barlow', Arial, sans-serif;
    background: linear-gradient(135deg, rgba(253, 121, 168, 0.2), rgba(255,255,255,0.1));
    border-radius: 12px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    border: 2px solid rgba(253, 121, 168, 0.3);
    backdrop-filter: blur(10px);
    box-shadow: 
      0 4px 16px rgba(0,0,0,0.2),
      inset 0 1px 0 rgba(255,255,255,0.1);
  }

  .multiplier-card:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 
      0 8px 32px rgba(0,0,0,0.3),
      inset 0 1px 0 rgba(255,255,255,0.2);
  }

  .multiplier-card .icon {
    font-size: 2.5em;
    margin-bottom: 15px;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
    color: #fd79a8;
  }

  .multiplier-card .title {
    font-weight: 700;
    margin-bottom: 8px;
    font-size: 1.1em;
  }

  .multiplier-card .description {
    font-size: 0.9em;
    opacity: 0.8;
    margin-bottom: 15px;
    line-height: 1.4;
  }

  .multiplier-card .cost {
    font-size: 1em;
    font-weight: 700;
    margin-top: 15px;
    color: #fd79a8;
  }

  /* Special features styles */
  .special-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
    padding: 20px;
  }

  .special-card {
    font-family: 'Barlow', Arial, sans-serif;
    background: linear-gradient(135deg, rgba(253, 203, 110, 0.2), rgba(255,255,255,0.1));
    border-radius: 12px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    border: 2px solid rgba(253, 203, 110, 0.3);
    backdrop-filter: blur(10px);
    box-shadow: 
      0 4px 16px rgba(0,0,0,0.2),
      inset 0 1px 0 rgba(255,255,255,0.1);
  }

  .special-card:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 
      0 8px 32px rgba(0,0,0,0.3),
      inset 0 1px 0 rgba(255,255,255,0.2);
  }

  .special-card .icon {
    font-size: 2.5em;
    margin-bottom: 15px;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
    color: #fdcb6e;
  }

  .special-card .title {
    font-weight: 700;
    margin-bottom: 8px;
    font-size: 1.1em;
  }

  .special-card .description {
    font-size: 0.9em;
    opacity: 0.8;
    margin-bottom: 15px;
    line-height: 1.4;
  }

  .special-card .cost {
    font-size: 1em;
    font-weight: 700;
    margin-top: 15px;
    color: #fdcb6e;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    body {
      padding: 10px;
    }
    
    h1 {
      font-size: 2.5em;
    }
    
    #mainBtn {
      font-size: 8em;
      width: 160px;
      height: 160px;
    }
    
    #score {
      font-size: 2.8em;
    }
    
    .upgrade-grid {
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 15px;
    }
    
    .achievement {
      padding: 15px;
    }
    
    .achievement .icon {
      font-size: 2.5em;
      margin-right: 15px;
    }

    #darkModeToggle,
    .golden-time {
      position: static;
      margin: 10px auto;
      display: block;
    }

    .container {
      padding: 0 10px;
    }
  }
  
  @media (max-width: 480px) {
    h1 {
      font-size: 2em;
    }
    
    #mainBtn {
      font-size: 6em;
      width: 120px;
      height: 120px;
    }
    
    #score {
      font-size: 2.2em;
    }
    
    .upgrade-grid {
      grid-template-columns: 1fr;
      gap: 10px;
    }
    
    .achievement {
      flex-direction: column;
      text-align: center;
      padding: 12px;
    }
    
    .achievement .icon {
      margin-right: 0;
      margin-bottom: 10px;
      font-size: 2em;
    }

    .upgrade.small .icon {
      font-size: 1.5em;
    }

    .upgrade.small {
      padding: 15px 10px;
      min-height: 80px;
    }

    #achievementPopup {
      padding: 20px 30px;
      font-size: 1.2em;
      min-width: 280px;
    }

    .notification {
      padding: 12px 20px;
      font-size: 0.9em;
    }
  }
</style>
</head>
<body>
<div class="container">
  <h1>
    💀 Skull Clicker™
  </h1>
  <button id="darkModeToggle" aria-pressed="false" aria-label="Toggle dark mode">🌙 Dark Mode</button>
  
  <div class="golden-time" id="goldenTimeIndicator">✨ GOLDEN TIME! 2x Points! ✨</div>
  
  <div id="score">0 <span class="score-decoration">💰 POINTS</span></div>
  <button id="mainBtn" aria-label="Main click button">💀</button>
  
  <div id="statsDisplay"></div>

  <!-- Achievements -->
  <button id="achievementsBtn" class="open">🏆 Achievements ✨</button>
  
  <div class="achievements-container" id="achievementsContainer" role="region" aria-label="Achievements">
    <div class="achievements-header" id="achievementsHeader" role="button" tabindex="0" aria-expanded="false" aria-controls="achievementsContent">🏆 Achievements ▼</div>
    <div class="achievements-content" id="achievementsContent" aria-hidden="true">
      <div class="achievements-list" id="achievementsList"></div>
    </div>
  </div>

  <div id="achievementPopup" role="alert" aria-live="assertive" aria-atomic="true"></div>

  <!-- Research -->
  <div class="research-container" id="researchContainer">
    <div class="research-header" id="researchHeader" role="button" tabindex="0" aria-expanded="false" aria-controls="researchContent">🔬 Research Lab ▼ <span class="badge badge-special">UNLOCK UPGRADES</span></div>
    <div class="research-content" id="researchContent" aria-hidden="true">
      <div class="research-grid" id="researchGrid"></div>
    </div>
  </div>

  <!-- Upgrades -->
<div class="upgrade-container" id="upgradesContainer">
  <div class="upgrade-header" id="upgradesHeader" role="button" tabindex="0" aria-expanded="false" aria-controls="upgradesContent">🔼 Upgrades ▼ <span id="upgradeCounter" class="badge badge-new">3/48</span></div>
  <div class="upgrade-content" id="upgradesContent" aria-hidden="true">
    <div class="upgrade-grid" id="upgradeGrid"></div>
  </div>
</div>

  <!-- Automation -->
<div class="automation-container" id="automationContainer">
  <div class="automation-header" id="automationHeader" role="button" tabindex="0" aria-expanded="false" aria-controls="automationContent">⚙️ Automation ▼</div>
  <div class="automation-content" id="automationContent" aria-hidden="true">
    <div class="automation-grid" id="automationGrid"></div>
  </div>
</div>

  <!-- Multipliers -->
<div class="multiplier-container" id="multiplierContainer">
  <div class="multiplier-header" id="multiplierHeader" role="button" tabindex="0" aria-expanded="false" aria-controls="multiplierContent">⚡ Multipliers ▼</div>
  <div class="multiplier-content" id="multiplierContent" aria-hidden="true">
    <div class="multiplier-grid" id="multiplierGrid"></div>
  </div>
</div>

<!-- Special Features -->
<div class="special-container" id="specialContainer">
  <div class="special-header" id="specialHeader" role="button" tabindex="0" aria-expanded="false" aria-controls="specialContent">🌟 Special Features ▼</div>
  <div class="special-content" id="specialContent" aria-hidden="true">
    <div class="special-grid" id="specialGrid"></div>
  </div>
</div>

  <!-- Facilities -->
  <div class="feature-container" id="featuresContainer">
    <div class="feature-header" id="featuresHeader" role="button" tabindex="0" aria-expanded="false" aria-controls="featuresContent">🏗️ Facilities ▼</div>
    <div class="feature-content" id="featuresContent" aria-hidden="true">
      <div class="feature-group">
        <button id="factoryBtn" class="feature">🏭 Buy Factory</button>
        <div id="factoryInfo" class="feature-info">Factory Level: 0<br>Benefit: +0%</div>
      </div>
      <div class="feature-group">
        <button id="bankBtn" class="feature">🏦 Upgrade Bank</button>
        <div id="bankInfo" class="feature-info">Bank Level: 0<br>Benefit: +0%</div>
      </div>
      <div class="feature-group">
        <button id="hotelBtn" class="feature">🏨 Upgrade Hotel</button>
        <div id="hotelInfo" class="feature-info">Hotel Level: 0<br>Benefit: +0%</div>
      </div>
      <div class="feature-group">
        <button id="shopBtn" class="feature">🏪 Upgrade Shop</button>
        <div id="shopInfo" class="feature-info">Shop Level: 0<br>Benefit: +0%</div>
      </div>
    </div>
  </div>

  <!-- Auto Clicker -->
  <div class="autoclicker-container" id="autoclickerContainer">
    <div class="autoclicker-header" id="autoclickerHeader" role="button" tabindex="0" aria-expanded="false" aria-controls="autoclickerContent">🤖 Auto Clicker ▼</div>
    <div class="autoclicker-content" id="autoclickerContent" aria-hidden="true">
      <div id="autoclickerInfo">Level: 0<br>Effect: +0/sec<br>Cost: 100</div>
      <button id="autoclickerBuyBtn">🤖 Buy Auto Clicker</button>
    </div>
  </div>

  <!-- Prestige -->
  <div class="prestige-container" id="prestigeContainer">
    <div class="prestige-header" id="prestigeHeader" role="button" tabindex="0" aria-expanded="false" aria-controls="prestigeContent">👑 Prestige ▼</div>
    <div class="prestige-content" id="prestigeContent" aria-hidden="true">
      <div id="prestigeInfo">Level: 0/12<br>Bonus Multiplier: x1<br>Cost: 1T</div>
      <button id="prestigeBuyBtn">👑 Buy Prestige</button>
    </div>
  </div>

  <!-- Ascension -->
  <div class="ascension-container" id="ascensionContainer">
    <div class="ascension-header" id="ascensionHeader" role="button" tabindex="0" aria-expanded="false" aria-controls="ascensionContent">✨ Ascension ▼</div>
    <div class="ascension-content" id="ascensionContent" aria-hidden="true">
      <div id="ascensionInfo">Level: 0/5<br>Bonus Multiplier: x1<br>Cost: 1Ud</div>
      <button id="ascensionBuyBtn">✨ Ascend</button>
    </div>
  </div>

  <!-- Cosmic -->
  <div class="cosmic-container" id="cosmicContainer">
    <div class="cosmic-header" id="cosmicHeader" role="button" tabindex="0" aria-expanded="false" aria-controls="cosmicContent">🌌 Cosmic Realm ▼</div>
    <div class="cosmic-content" id="cosmicContent" aria-hidden="true">
      <div id="cosmicInfo">Level: 0/3<br>Bonus Multiplier: x1<br>Cost: 1V</div>
      <button id="cosmicBuyBtn">🌌 Enter Cosmic Realm</button>
    </div>
  </div>

  <!-- Prestige Shop -->
  <div class="prestige-shop-container" id="prestigeShopContainer">
    <div class="prestige-shop-header" id="prestigeShopHeader" role="button" tabindex="0" aria-expanded="false" aria-controls="prestigeShopContent">🛍️ Prestige Shop ▼</div>
    <div class="prestige-shop-content" id="prestigeShopContent" aria-hidden="true">
      <div class="prestige-shop-grid" id="prestigeShopGrid"></div>
    </div>
  </div>

  <!-- Cosmic Shop -->
  <div class="cosmic-shop-container" id="cosmicShopContainer">
    <div class="cosmic-shop-header" id="cosmicShopHeader" role="button" tabindex="0" aria-expanded="false" aria-controls="cosmicShopContent">🌠 Cosmic Shop ▼</div>
    <div class="cosmic-shop-content" id="cosmicShopContent" aria-hidden="true">
      <div class="cosmic-shop-grid" id="cosmicShopGrid"></div>
    </div>
  </div>

  <!-- Ascension Shop -->
  <div class="ascension-shop-container" id="ascensionShopContainer">
    <div class="ascension-shop-header" id="ascensionShopHeader" role="button" tabindex="0" aria-expanded="false" aria-controls="ascensionShopContent">✨ Ascension Shop ▼</div>
    <div class="ascension-shop-content" id="ascensionShopContent" aria-hidden="true">
      <div class="ascension-shop-grid" id="ascensionShopGrid"></div>
    </div>
  </div>

  <!-- Minigames -->
  <div class="minigame-container" id="minigameContainer">
    <div class="minigame-header" id="minigameHeader" role="button" tabindex="0" aria-expanded="false" aria-controls="minigameContent">🎮 Minigames ▼</div>
    <div class="minigame-content" id="minigameContent" aria-hidden="true">
      <div class="minigame-grid" id="minigameGrid"></div>
    </div>
  </div>

  <!-- Challenges -->
  <div class="challenge-container" id="challengeContainer">
    <div class="challenge-header" id="challengeHeader" role="button" tabindex="0" aria-expanded="false" aria-controls="challengeContent">🏅 Challenges ▼</div>
    <div class="challenge-content" id="challengeContent" aria-hidden="true">
      <div class="challenge-grid" id="challengeGrid"></div>
    </div>
  </div>

  <!-- Events -->
  <div class="event-container" id="eventContainer">
    <div class="event-header" id="eventHeader" role="button" tabindex="0" aria-expanded="false" aria-controls="eventContent">🎉 Special Events ▼</div>
    <div class="event-content" id="eventContent" aria-hidden="true">
      <div id="currentEvent"></div>
    </div>
  </div>

  <!-- Save/Load -->
  <div class="save-container" id="saveContainer">
    <div class="save-header" id="saveHeader" role="button" tabindex="0" aria-expanded="true" aria-controls="saveContent">💾 Save & Load ▲</div>
    <div class="save-content" id="saveContent" aria-hidden="false">
      <button id="saveBtn">💾 Save Game</button>
      <button id="loadBtn">📁 Load Game</button>
      <button id="exportBtn">📤 Export Save</button>
      <button id="importBtn">📥 Import Save</button>
      <button id="resetBtn">♻️ Full Reset</button>
      <div id="lastSavedInfo" style="margin-top: 15px; font-size: 1em; color: var(--text-color); opacity: 0.8;"></div>
    </div>
  </div>
</div>

<div id="notificationArea"></div>

<script>
// DARK MODE TOGGLE
const darkModeBtn = document.getElementById('darkModeToggle');
darkModeBtn.addEventListener('click', () => {
  document.body.classList.toggle('dark-mode');
  const isDark = document.body.classList.contains('dark-mode');
  darkModeBtn.innerHTML = isDark ? '☀️ Light Mode' : '🌙 Dark Mode';
  darkModeBtn.setAttribute('aria-pressed', isDark);
});

// Toggle section helper function for headers + content
function toggleSection(headerId, contentId) {
  const header = document.getElementById(headerId);
  const content = document.getElementById(contentId);

  // Return if elements don't exist
  if (!header || !content) {
    console.warn(`Elements not found: ${headerId} or ${contentId}`);
    return;
  }

  function toggle() {
    const expanded = content.style.display === 'block';
    if (expanded) {
      content.style.display = 'none';
      header.textContent = header.textContent.replace('▲', '▼');
      header.setAttribute('aria-expanded', 'false');
      content.setAttribute('aria-hidden', 'true');
    } else {
      content.style.display = 'block';
      header.textContent = header.textContent.replace('▼', '▲');
      header.setAttribute('aria-expanded', 'true');
      content.setAttribute('aria-hidden', 'false');
    }
  }

  header.addEventListener('click', toggle);
  header.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      toggle();
    }
  });
}

// Initialize toggles for all sections with error handling
const sectionHeaders = [
  'upgradesHeader', 'featuresHeader', 'autoclickerHeader', 
  'prestigeHeader', 'saveHeader', 'achievementsHeader',
  'minigameHeader', 'researchHeader', 'challengeHeader',
  'eventHeader', 'ascensionHeader', 'cosmicHeader',
  'prestigeShopHeader', 'cosmicShopHeader', 'ascensionShopHeader',
  'automationHeader', 'multiplierHeader', 'specialHeader'
];

sectionHeaders.forEach(id => {
  const contentId = id.replace('Header', 'Content');
  toggleSection(id, contentId);
});


// Achievements button toggle
document.getElementById('achievementsBtn').addEventListener('click', function() {
  const container = document.getElementById('achievementsContainer');
  const header = document.getElementById('achievementsHeader');
  const content = document.getElementById('achievementsContent');
  
  if (!header || !content) {
    console.error('Achievements elements not found');
    return;
  }
  
  if (content.style.display === 'block') {
    content.style.display = 'none';
    header.textContent = '🏆 Achievements ▼';
    header.setAttribute('aria-expanded', 'false');
    content.setAttribute('aria-hidden', 'true');
    this.classList.remove('open');
  } else {
    content.style.display = 'block';
    header.textContent = '🏆 Achievements ▲';
    header.setAttribute('aria-expanded', 'true');
    content.setAttribute('aria-hidden', 'false');
    this.classList.add('open');
  }
});

// ----- Main Game Variables -----
let score = 0;
let baseMultiplier = 1;
let factoryLevel = 0;
const maxLevel = 100;
let bankLevel = 0;
let hotelLevel = 0;
let shopLevel = 0;
let autoclickerLevel = 0;
let autoclickerBaseCost = 100;
let prestigeLevel = 0;
const prestigeMaxLevel = 12;
const prestigeBaseCost = 1e12;
let prestigeCost = prestigeBaseCost;
let ascensionLevel = 0;
const ascensionMaxLevel = 5;
const ascensionBaseCost = 1e36;
let ascensionCost = ascensionBaseCost;
let cosmicLevel = 0;
const cosmicMaxLevel = 3;
const cosmicBaseCost = 1e60;
let cosmicCost = cosmicBaseCost;
let clicks = 0;

// Golden time variables
let goldenTimeActive = false;
let goldenTimeEnd = 0;
let goldenTimeChance = 0.0005;
let goldenTimeDuration = 30000;

// Critical hit variables
let criticalHitChance = 0.05;
let criticalHitMultiplier = 2;
let rainbowCritChance = 0.001;

// Add variables
let fullResets = 0;
let criticalHits = 0;
let goldenTimeExperienced = 0;
let rainbowCrits = 0;
let minigamesCompleted = 0;
let researchCompleted = 0;
let challengesCompleted = 0;
let eventsParticipated = 0;
let prestigeShopPurchases = 0;
let cosmicShopPurchases = 0;
let ascensionShopPurchases = 0;
let elementalsUnlocked = 0;
let maxOfflineTime = 0;

// Research unlock system
let upgradesUnlocked = 3; // Start with 3 upgrades unlocked

// ----- 48 Upgrades System -----
const upgrades = [
  // Tier 1: Basic (0-2)
  { icon: '🍓', power: '+1', cost: 20, description: 'Small boost to your clicking power', tier: 'basic', unlockRequirement: 0 },
  { icon: '🍒', power: '+10', cost: 400, description: 'Moderate boost to your clicking power', tier: 'basic', unlockRequirement: 0 },
  { icon: '🍎', power: '+100', cost: 8e3, description: 'Significant boost to your clicking power', tier: 'basic', unlockRequirement: 0 },
  
  // Tier 2: Common (3-5) - Unlock with first research
  { icon: '🍅', power: '+1000', cost: 1.6e5, description: 'Major boost to your clicking power', tier: 'common', unlockRequirement: 1 },
  { icon: '🌶️', power: '+10000', cost: 3.2e6, description: 'Huge boost to your clicking power', tier: 'common', unlockRequirement: 1 },
  { icon: '🍉', power: '+100000', cost: 6.4e7, description: 'Massive boost to your clicking power', tier: 'common', unlockRequirement: 1 },
  
  // Tier 3: Uncommon (6-8) - Unlock with second research
  { icon: '🍑', power: '+1e+6', cost: 2.56e9, description: 'Enormous boost to your clicking power', tier: 'uncommon', unlockRequirement: 2 },
  { icon: '🍊', power: '+1e+7', cost: 1.03e11, description: 'Gigantic boost to your clicking power', tier: 'uncommon', unlockRequirement: 2 },
  { icon: '🥕', power: '+1e+8', cost: 4.13e12, description: 'Colossal boost to your clicking power', tier: 'uncommon', unlockRequirement: 2 },
  
  // Tier 4: Rare (9-11) - Unlock with third research
  { icon: '🥭', power: '+1e+9', cost: 1.61e14, description: 'Titanic boost to your clicking power', tier: 'rare', unlockRequirement: 3 },
  { icon: '🍍', power: '+1e+10', cost: 6.44e15, description: 'Legendary boost to your clicking power', tier: 'rare', unlockRequirement: 3 },
  { icon: '🍌', power: '+1e+11', cost: 2.76e17, description: 'Mythical boost to your clicking power', tier: 'rare', unlockRequirement: 3 },
  
  // Tier 5: Epic (12-14) - Unlock with fourth research
  { icon: '🌽', power: '+1e+12', cost: 1.04e19, description: 'Godly boost to your clicking power', tier: 'epic', unlockRequirement: 4 },
  { icon: '🍋', power: '+1e+13', cost: 4.17e20, description: 'Divine boost to your clicking power', tier: 'epic', unlockRequirement: 4 },
  { icon: '🍈', power: '+1e+14', cost: 1.68e22, description: 'Celestial boost to your clicking power', tier: 'epic', unlockRequirement: 4 },
  
  // Tier 6: Legendary (15-17) - Unlock with fifth research
  { icon: '🍐', power: '+1e+15', cost: 6.72e23, description: 'Cosmic boost to your clicking power', tier: 'legendary', unlockRequirement: 5 },
  { icon: '🫛', power: '+1e+16', cost: 2.88e25, description: 'Universal boost to your clicking power', tier: 'legendary', unlockRequirement: 5 },
  { icon: '🥬', power: '+1e+17', cost: 1.37e27, description: 'Multiversal boost to your clicking power', tier: 'legendary', unlockRequirement: 5 },
  
  // Tier 7: Mythic (18-20) - Unlock with sixth research
  { icon: '🫑', power: '+1e+18', cost: 6.95e28, description: 'Omniversal boost to your clicking power', tier: 'mythic', unlockRequirement: 6 },
  { icon: '🍏', power: '+1e+19', cost: 2.78e30, description: 'Infinite boost to your clicking power', tier: 'mythic', unlockRequirement: 6 },
  { icon: '🥝', power: '+1e+20', cost: 1.28e32, description: 'Ultimate boost to your clicking power', tier: 'mythic', unlockRequirement: 6 },
  
  // Tier 8: Divine (21-23) - Unlock with seventh research
  { icon: '🥑', power: '+1e+21', cost: 5.12e33, description: 'Final boost to your clicking power', tier: 'divine', unlockRequirement: 7 },
  { icon: '🫒', power: '+1e+22', cost: 2.05e35, description: 'Absolute boost to your clicking power', tier: 'divine', unlockRequirement: 7 },
  { icon: '🥦', power: '+1e+23', cost: 8.20e36, description: 'Supreme boost to your clicking power', tier: 'divine', unlockRequirement: 7 },
  
  // Tier 9: Transcendent (24-26) - Unlock with eighth research
  { icon: '🫐', power: '+1e+24', cost: 3.28e38, description: 'Transcendent boost to your clicking power', tier: 'transcendent', unlockRequirement: 8 },
  { icon: '🍇', power: '+1e+25', cost: 1.32e40, description: 'Eternal boost to your clicking power', tier: 'transcendent', unlockRequirement: 8 },
  { icon: '🍆', power: '+1e+26', cost: 5.28e41, description: 'Primordial boost to your clicking power', tier: 'transcendent', unlockRequirement: 8 },
  
  // Tier 10: Cosmic (27-29) - Unlock with ninth research
  { icon: '🍠', power: '+1e+27', cost: 2.24e43, description: 'Ancient boost to your clicking power', tier: 'cosmic', unlockRequirement: 9 },
  { icon: '🥥', power: '+1e+28', cost: 9.96e44, description: 'Arcane boost to your clicking power', tier: 'cosmic', unlockRequirement: 9 },
  { icon: '🥔', power: '+1e+29', cost: 3.84e46, description: 'Mystical boost to your clicking power', tier: 'cosmic', unlockRequirement: 9 },
  
  // Tier 11: Universal (30-32) - Unlock with tenth research
  { icon: '🧅', power: '+1e+30', cost: 1.56e48, description: 'Enigmatic boost to your clicking power', tier: 'universal', unlockRequirement: 10 },
  { icon: '🫚', power: '+1e+31', cost: 6.24e49, description: 'Unfathomable boost to your clicking power', tier: 'universal', unlockRequirement: 10 },
  { icon: '🌰', power: '+1e+32', cost: 2.5e51, description: 'Boundless boost to your clicking power', tier: 'universal', unlockRequirement: 10 },
  
  // Tier 12: Quantum (33-35) - Unlock with eleventh research
  { icon: '🪐', power: '+1e+33', cost: 1e53, description: 'Planetary boost to your clicking power', tier: 'quantum', unlockRequirement: 11 },
  { icon: '🌠', power: '+1e+34', cost: 4e54, description: 'Stellar boost to your clicking power', tier: 'quantum', unlockRequirement: 11 },
  { icon: '🌌', power: '+1e+35', cost: 1.6e56, description: 'Galactic boost to your clicking power', tier: 'quantum', unlockRequirement: 11 },
  
  // Tier 13: Dimensional (36-38) - Unlock with twelfth research
  { icon: '🛸', power: '+1e+36', cost: 6.4e57, description: 'Interstellar boost to your clicking power', tier: 'dimensional', unlockRequirement: 12 },
  { icon: '☄️', power: '+1e+37', cost: 2.56e59, description: 'Cometary boost to your clicking power', tier: 'dimensional', unlockRequirement: 12 },
  { icon: '🌑', power: '+1e+38', cost: 1.02e61, description: 'Lunar boost to your clicking power', tier: 'dimensional', unlockRequirement: 12 },
  
  // Tier 14: Temporal (39-41) - Unlock with thirteenth research
  { icon: '🌕', power: '+1e+39', cost: 4.1e62, description: 'Solar boost to your clicking power', tier: 'temporal', unlockRequirement: 13 },
  { icon: '🪶', power: '+1e+40', cost: 1.64e64, description: 'Celestial boost to your clicking power', tier: 'temporal', unlockRequirement: 13 },
  { icon: '🌙', power: '+1e+41', cost: 6.56e65, description: 'Cosmic boost to your clicking power', tier: 'temporal', unlockRequirement: 13 },
  
  // Tier 15: Ethereal (42-44) - Unlock with fourteenth research
  { icon: '🌟', power: '+1e+42', cost: 2.62e67, description: 'Starlight boost to your clicking power', tier: 'ethereal', unlockRequirement: 14 },
  { icon: '💫', power: '+1e+43', cost: 1.05e69, description: 'Nebula boost to your clicking power', tier: 'ethereal', unlockRequirement: 14 },
  { icon: '🌛', power: '+1e+44', cost: 4.2e70, description: 'Quasar boost to your clicking power', tier: 'ethereal', unlockRequirement: 14 },
  
  // Tier 16: Omega (45-47) - Unlock with fifteenth research
  { icon: '🌜', power: '+1e+45', cost: 1.68e72, description: 'Pulsar boost to your clicking power', tier: 'omega', unlockRequirement: 15 },
  { icon: '🚀', power: '+1e+46', cost: 6.72e73, description: 'Astral boost to your clicking power', tier: 'omega', unlockRequirement: 15 },
  { icon: '👽', power: '+1e+47', cost: 2.69e75, description: 'Alien boost to your clicking power', tier: 'omega', unlockRequirement: 15 },
  
  // Final upgrade (47) - Unlock with all 16 research
  { icon: '⚡', power: '+1e+48', cost: 1.08e77, description: 'Ultimate cosmic boost to your clicking power', tier: 'omega', unlockRequirement: 16 }
];

const baseUpgradeCosts = upgrades.map(u => u.cost);

// ----- Research Projects System (16 total) -----
let researchProjects = [
  // Each research unlocks 3 upgrades
  { id: 'upgrade_research_1', icon: '🔬', title: 'Basic Enhancement Research', description: 'Unlock Common tier upgrades (3 upgrades)', cost: 1e4, unlocked: true, completed: false, unlockInfo: 'Unlocks upgrades 4-6' },
  { id: 'upgrade_research_2', icon: '🧪', title: 'Advanced Materials Research', description: 'Unlock Uncommon tier upgrades (3 upgrades)', cost: 1e6, unlocked: false, completed: false, unlockInfo: 'Unlocks upgrades 7-9' },
  { id: 'upgrade_research_3', icon: '⚗️', title: 'Rare Elements Research', description: 'Unlock Rare tier upgrades (3 upgrades)', cost: 1e8, unlocked: false, completed: false, unlockInfo: 'Unlocks upgrades 10-12' },
  { id: 'upgrade_research_4', icon: '🔬', title: 'Epic Compounds Research', description: 'Unlock Epic tier upgrades (3 upgrades)', cost: 1e10, unlocked: false, completed: false, unlockInfo: 'Unlocks upgrades 13-15' },
  { id: 'upgrade_research_5', icon: '🧬', title: 'Legendary Synthesis Research', description: 'Unlock Legendary tier upgrades (3 upgrades)', cost: 1e12, unlocked: false, completed: false, unlockInfo: 'Unlocks upgrades 16-18' },
  { id: 'upgrade_research_6', icon: '🌟', title: 'Mythic Crystals Research', description: 'Unlock Mythic tier upgrades (3 upgrades)', cost: 1e15, unlocked: false, completed: false, unlockInfo: 'Unlocks upgrades 19-21' },
  { id: 'upgrade_research_7', icon: '✨', title: 'Divine Essence Research', description: 'Unlock Divine tier upgrades (3 upgrades)', cost: 1e18, unlocked: false, completed: false, unlockInfo: 'Unlocks upgrades 22-24' },
  { id: 'upgrade_research_8', icon: '💎', title: 'Transcendent Matter Research', description: 'Unlock Transcendent tier upgrades (3 upgrades)', cost: 1e21, unlocked: false, completed: false, unlockInfo: 'Unlocks upgrades 25-27' },
  { id: 'upgrade_research_9', icon: '🌌', title: 'Cosmic Energy Research', description: 'Unlock Cosmic tier upgrades (3 upgrades)', cost: 1e24, unlocked: false, completed: false, unlockInfo: 'Unlocks upgrades 28-30' },
  { id: 'upgrade_research_10', icon: '🌠', title: 'Universal Forces Research', description: 'Unlock Universal tier upgrades (3 upgrades)', cost: 1e27, unlocked: false, completed: false, unlockInfo: 'Unlocks upgrades 31-33' },
  { id: 'upgrade_research_11', icon: '⚛️', title: 'Quantum Mechanics Research', description: 'Unlock Quantum tier upgrades (3 upgrades)', cost: 1e30, unlocked: false, completed: false, unlockInfo: 'Unlocks upgrades 34-36' },
  { id: 'upgrade_research_12', icon: '🕳️', title: 'Dimensional Physics Research', description: 'Unlock Dimensional tier upgrades (3 upgrades)', cost: 1e33, unlocked: false, completed: false, unlockInfo: 'Unlocks upgrades 37-39' },
  { id: 'upgrade_research_13', icon: '⏰', title: 'Temporal Dynamics Research', description: 'Unlock Temporal tier upgrades (3 upgrades)', cost: 1e36, unlocked: false, completed: false, unlockInfo: 'Unlocks upgrades 40-42' },
  { id: 'upgrade_research_14', icon: '👻', title: 'Ethereal Manifestation Research', description: 'Unlock Ethereal tier upgrades (3 upgrades)', cost: 1e39, unlocked: false, completed: false, unlockInfo: 'Unlocks upgrades 43-45' },
  { id: 'upgrade_research_15', icon: '🔥', title: 'Omega Protocol Research', description: 'Unlock Omega tier upgrades (3 upgrades)', cost: 1e42, unlocked: false, completed: false, unlockInfo: 'Unlocks upgrades 46-48' },
  { id: 'upgrade_research_16', icon: '💥', title: 'Ultimate Power Research', description: 'Unlock the final ultimate upgrade', cost: 1e45, unlocked: false, completed: false, unlockInfo: 'Unlocks final upgrade 48' },
  
  // Additional research for game mechanics
  { id: 'critical_research', icon: '💥', title: 'Critical Research', description: 'Increase critical hit chance by 1%', cost: 1e6, unlocked: true, completed: false },
  { id: 'golden_research', icon: '🌟', title: 'Golden Research', description: 'Increase golden time chance by 0.01%', cost: 5e6, unlocked: false, completed: false },
  { id: 'autoclicker_research', icon: '🤖', title: 'Autoclicker Research', description: 'Autoclickers are 10% more effective', cost: 1e7, unlocked: false, completed: false },
  { id: 'factory_research', icon: '🏭', title: 'Factory Research', description: 'Factories provide 10% more bonus', cost: 2e7, unlocked: false, completed: false }
];

// ----- Automation System -----
let automationFeatures = [
  { id: 'auto_buy_upgrades', icon: '🔄', title: 'Auto Buy Upgrades', description: 'Automatically purchase cheapest upgrades', cost: 1e15, level: 0, maxLevel: 10, unlocked: false, active: false },
  { id: 'auto_buy_facilities', icon: '🏗️', title: 'Auto Buy Facilities', description: 'Automatically upgrade facilities', cost: 1e18, level: 0, maxLevel: 5, unlocked: false, active: false },
  { id: 'auto_prestige', icon: '👑', title: 'Auto Prestige', description: 'Automatically prestige when beneficial', cost: 1e21, level: 0, maxLevel: 3, unlocked: false, active: false },
  { id: 'auto_research', icon: '🔬', title: 'Auto Research', description: 'Automatically complete research projects', cost: 1e24, level: 0, maxLevel: 1, unlocked: false, active: false }
];

// ----- Multiplier System -----
let multiplierFeatures = [
  { id: 'click_multiplier', icon: '👆', title: 'Click Power Multiplier', description: 'Increase click power by 50%', cost: 1e12, level: 0, maxLevel: 20, unlocked: true, multiplier: 1.5 },
  { id: 'crit_multiplier', icon: '💥', title: 'Critical Hit Multiplier', description: 'Increase critical hit damage by 25%', cost: 1e14, level: 0, maxLevel: 15, unlocked: false, multiplier: 1.25 },
  { id: 'golden_multiplier', icon: '🌟', title: 'Golden Time Multiplier', description: 'Increase golden time effectiveness by 100%', cost: 1e16, level: 0, maxLevel: 10, unlocked: false, multiplier: 2.0 },
  { id: 'facility_multiplier', icon: '🏭', title: 'Facility Efficiency Multiplier', description: 'Increase all facility bonuses by 20%', cost: 1e18, level: 0, maxLevel: 25, unlocked: false, multiplier: 1.2 }
];

// ----- Special Features System -----
let specialFeatures = [
  { id: 'particle_effects', icon: '✨', title: 'Enhanced Particle Effects', description: 'Unlock beautiful particle effects', cost: 1e10, unlocked: true, purchased: false },
  { id: 'skull_evolution', icon: '💀', title: 'Skull Evolution', description: 'Unlock different skull appearances', cost: 1e13, unlocked: false, purchased: false },
  { id: 'rainbow_mode', icon: '🌈', title: 'Rainbow Mode', description: 'Unlock rainbow visual effects', cost: 1e16, unlocked: false, purchased: false },
  { id: 'cosmic_background', icon: '🌌', title: 'Cosmic Background', description: 'Unlock animated cosmic background', cost: 1e19, unlocked: false, purchased: false },
  { id: 'time_warp', icon: '⏰', title: 'Time Warp', description: 'Unlock time manipulation abilities', cost: 1e22, unlocked: false, purchased: false }
];

// ----- Achievements System -----
const achievements = [
  // Click achievements
  { id: 'first_click', icon: '👆', title: 'First Click', description: 'Click the skull for the first time', condition: (g) => g.clicks >= 1, unlocked: false, progress: (g) => g.clicks >= 1 ? 1 : g.clicks },
  { id: 'hundred_clicks', icon: '💯', title: 'Century', description: 'Reach 100 clicks', condition: (g) => g.clicks >= 100, unlocked: false, progress: (g) => Math.min(g.clicks / 100, 1) },
  { id: 'thousand_clicks', icon: '👍', title: 'Grand Master', description: 'Reach 1,000 clicks', condition: (g) => g.clicks >= 1000, unlocked: false, progress: (g) => Math.min(g.clicks / 1000, 1) },
  { id: 'tenk_clicks', icon: '🎯', title: 'Ten Thousand', description: 'Reach 10,000 clicks', condition: g => g.clicks >= 10000, unlocked: false, progress: (g) => Math.min(g.clicks / 10000, 1) },
  { id: 'hundredk_clicks', icon: '🔥', title: 'Hundred Thousand', description: 'Reach 100,000 clicks', condition: g => g.clicks >= 100000, unlocked: false, progress: (g) => Math.min(g.clicks / 100000, 1) },
  { id: 'million_clicks', icon: '🏆', title: 'Million Clicks', description: 'Reach 1 million clicks', condition: g => g.clicks >= 1000000, unlocked: false, progress: (g) => Math.min(g.clicks / 1000000, 1) },

  // Score achievements  
  { id: 'ten_thousand_score', icon: '✨', title: 'Score Milestone', description: 'Reach 10,000 points', condition: (g) => g.score >= 1e4, unlocked: false, progress: (g) => Math.min(g.score / 1e4, 1) },
  { id: 'millionaire', icon: '💰', title: 'Millionaire', description: 'Reach 1 million points', condition: (g) => g.score >= 1e6, unlocked: false, progress: (g) => Math.min(g.score / 1e6, 1) },
  { id: 'billionaire', icon: '💎', title: 'Billionaire', description: 'Reach 1 billion points', condition: (g) => g.score >= 1e9, unlocked: false, progress: (g) => Math.min(g.score / 1e9, 1) },
  { id: 'trillionaire', icon: '🪙', title: 'Trillionaire', description: 'Reach 1 trillion points', condition: (g) => g.score >= 1e12, unlocked: false, progress: (g) => Math.min(g.score / 1e12, 1) },
  { id: 'quadrillionaire', icon: '💸', title: 'Quadrillionaire', description: 'Reach 1 quadrillion points', condition: (g) => g.score >= 1e15, unlocked: false, progress: (g) => Math.min(g.score / 1e15, 1) },
{ id: 'sextillionaire', icon: '🥇', title: 'Sextillionaire', description: 'Reach 1 sextillion points', condition: (g) => g.score >= 1e21, unlocked: false, progress: (g) => Math.min(g.score / 1e21, 1) },
  { id: 'octillionaire', icon: '🦾', title: 'Octillionaire', description: 'Reach 1 octillion points', condition: (g) => g.score >= 1e27, unlocked: false, progress: (g) => Math.min(g.score / 1e27, 1) },
  { id: 'decillionaire', icon: '🌌', title: 'Decillionaire', description: 'Reach 1 decillion points', condition: (g) => g.score >= 1e33, unlocked: false, progress: (g) => Math.min(g.score / 1e33, 1) },


  // Upgrade achievements
  { id: 'first_upgrade', icon: '🔼', title: 'Upgrader', description: 'Purchase your first upgrade', condition: (g) => g.baseMultiplier > 1, unlocked: false, progress: (g) => g.baseMultiplier > 1 ? 1 : 0 },
  { id: 'upgrade_tier_common', icon: '🔬', title: 'Research Scientist', description: 'Unlock Common tier upgrades', condition: (g) => g.upgradesUnlocked >= 6, unlocked: false, progress: (g) => Math.min(g.upgradesUnlocked / 6, 1) },
  { id: 'upgrade_tier_epic', icon: '⚡', title: 'Epic Researcher', description: 'Unlock Epic tier upgrades', condition: (g) => g.upgradesUnlocked >= 15, unlocked: false, progress: (g) => Math.min(g.upgradesUnlocked / 15, 1) },
  { id: 'upgrade_tier_omega', icon: '♾️', title: 'Omega Master', description: 'Unlock all upgrades', condition: (g) => g.upgradesUnlocked >= 48, unlocked: false, progress: (g) => Math.min(g.upgradesUnlocked / 48, 1) },

  // Research achievements
  { id: 'first_research', icon: '🔬', title: 'Scientist', description: 'Complete your first research project', condition: (g) => g.researchCompleted >= 1, unlocked: false, progress: (g) => Math.min(g.researchCompleted, 1) },
  { id: 'research_master', icon: '🧪', title: 'Research Master', description: 'Complete 10 research projects', condition: (g) => g.researchCompleted >= 10, unlocked: false, progress: (g) => Math.min(g.researchCompleted / 10, 1) },
  { id: 'mad_scientist', icon: '🧬', title: 'Mad Scientist', description: 'Complete all upgrade research', condition: (g) => g.researchCompleted >= 16, unlocked: false, progress: (g) => Math.min(g.researchCompleted / 16, 1) },

  // Facility achievements
  { id: 'first_factory', icon: '🏭', title: 'Industrialist', description: 'Build your first factory', condition: (g) => g.factoryLevel >= 1, unlocked: false, progress: (g) => Math.min(g.factoryLevel, 1) },
  { id: 'max_factory', icon: '🏭', title: 'Factory Master', description: 'Max out Factory level (100)', condition: (g) => g.factoryLevel >= 100, unlocked: false, progress: (g) => Math.min(g.factoryLevel / 100, 1) },
  { id: 'first_bank', icon: '🏦', title: 'Banker', description: 'Upgrade your first bank', condition: (g) => g.bankLevel >= 1, unlocked: false, progress: (g) => Math.min(g.bankLevel, 1) },
  { id: 'max_bank', icon: '🏦', title: 'Banking Mogul', description: 'Max out Bank level (100)', condition: (g) => g.bankLevel >= 100, unlocked: false, progress: (g) => Math.min(g.bankLevel / 100, 1) },
  { id: 'first_hotel', icon: '🏨', title: 'Hotelier', description: 'Upgrade your first hotel', condition: (g) => g.hotelLevel >= 1, unlocked: false, progress: (g) => Math.min(g.hotelLevel, 1) },
  { id: 'max_hotel', icon: '🏨', title: 'Hotel Tycoon', description: 'Max out Hotel level (100)', condition: (g) => g.hotelLevel >= 100, unlocked: false, progress: (g) => Math.min(g.hotelLevel / 100, 1) },
  { id: 'first_shop', icon: '🏪', title: 'Shopkeeper', description: 'Upgrade your first shop', condition: (g) => g.shopLevel >= 1, unlocked: false, progress: (g) => Math.min(g.shopLevel, 1) },
  { id: 'max_shop', icon: '🏪', title: 'Shopping Empire', description: 'Max out Shop level (100)', condition: (g) => g.shopLevel >= 100, unlocked: false, progress: (g) => Math.min(g.shopLevel / 100, 1) },
  { id: 'first_autoclicker', icon: '🤖', title: 'Automator', description: 'Purchase your first auto clicker', condition: (g) => g.autoclickerLevel >= 1, unlocked: false, progress: (g) => Math.min(g.autoclickerLevel, 1) },
  { id: 'fifty_autoclickers', icon: '🛠️', title: 'Automation Factory', description: 'Buy 50 auto clickers', condition: (g) => g.autoclickerLevel >= 50, unlocked: false, progress: (g) => Math.min(g.autoclickerLevel / 50, 1) },
  { id: 'max_autoclicker', icon: '🤖', title: 'Robot Overlord', description: 'Max out Auto Clicker level (200)', condition: (g) => g.autoclickerLevel >= 200, unlocked: false, progress: (g) => Math.min(g.autoclickerLevel / 200, 1) },

  // Prestige achievements
  { id: 'first_prestige', icon: '🔄', title: 'Ascended', description: 'Prestige for the first time', condition: (g) => g.prestigeLevel >= 1, unlocked: false, progress: (g) => Math.min(g.prestigeLevel, 1) },
 { id: 'third_prestige', icon: '🔄', title: 'Ascended III', description: 'Prestige for the third time', condition: (g) => g.prestigeLevel >= 3, unlocked: false, progress: (g) => Math.min(g.prestigeLevel / 3, 1) },
  { id: 'max_prestige', icon: '👑', title: 'Supreme Being', description: 'Reach maximum prestige level (12)', condition: (g) => g.prestigeLevel >= 12, unlocked: false, progress: (g) => Math.min(g.prestigeLevel / 12, 1) },

  // Special achievements
  { id: 'critical_hit', icon: '💥', title: 'Critical Hit!', description: 'Get a critical hit', condition: (g) => g.criticalHits >= 1, unlocked: false, progress: (g) => Math.min(g.criticalHits, 1) },
  { id: 'golden_time', icon: '🌟', title: 'Golden Moment', description: 'Experience golden time', condition: (g) => g.goldenTimeExperienced >= 1, unlocked: false, progress: (g) => Math.min(g.goldenTimeExperienced, 1) },
  { id: 'automation_master', icon: '⚙️', title: 'Automation Master', description: 'Unlock automation features', condition: (g) => g.automationUnlocked >= 1, unlocked: false, progress: (g) => Math.min(g.automationUnlocked, 1) },
{ id: 'rainbow_crit', icon: '🌈', title: 'Rainbow Warrior', description: 'Get a rainbow critical hit', condition: (g) => g.rainbowCrits >= 1, unlocked: false, progress: (g) => Math.min(g.rainbowCrits, 1) },
{ id: 'full_reset', icon: '🔄', title: 'Fresh Start', description: 'Perform a full reset', condition: (g) => g.fullResets >= 1, unlocked: false, progress: (g) => Math.min(g.fullResets, 1) },
{ id: 'research_complete', icon: '🧪', title: 'Research Master', description: 'Complete all research projects', condition: (g) => g.researchCompleted >= researchProjects.length, unlocked: false, progress: (g) => Math.min(g.researchCompleted / researchProjects.length, 1) },
{ id: 'challenge_master', icon: '🏆', title: 'Challenge Master', description: 'Complete all challenges', condition: (g) => g.challengesCompleted >= challenges.length, unlocked: false, progress: (g) => Math.min(g.challengesCompleted / challenges.length, 1) },
{ id: 'minigame_master', icon: '🎮', title: 'Minigame Master', description: 'Complete all minigames', condition: (g) => g.minigamesCompleted >= minigames.length, unlocked: false, progress: (g) => Math.min(g.minigamesCompleted / minigames.length, 1) },
{ id: 'shop_collector', icon: '🛍️', title: 'Shop Collector', description: 'Purchase all shop items', condition: (g) => g.prestigeShopPurchases >= prestigeShopItems.length && g.cosmicShopPurchases >= cosmicShopItems.length && g.ascensionShopPurchases >= ascensionShopItems.length, unlocked: false, progress: (g) => Math.min((g.prestigeShopPurchases + g.cosmicShopPurchases + g.ascensionShopPurchases) / (prestigeShopItems.length + cosmicShopItems.length + ascensionShopItems.length), 1) },
];

// Minigames
let minigames = [
  { id: 'click_frenzy', icon: '⚡', title: 'Click Frenzy', description: 'Click as fast as you can for 10 seconds!', unlocked: true, completed: false },
  { id: 'memory_game', icon: '🧠', title: 'Memory Game', description: 'Test your memory with this matching game', unlocked: false, completed: false },
  { id: 'timed_clicks', icon: '⏱️', title: 'Timed Clicks', description: 'Click the target within the time limit', unlocked: false, completed: false },
  { id: 'number_guess', icon: '🔢', title: 'Number Guess', description: 'Guess the correct number to win', unlocked: false, completed: false },
  { id: 'reaction_test', icon: '👆', title: 'Reaction Test', description: 'Click when you see the signal', unlocked: false, completed: false }
];

// Challenges
let challenges = [
  { id: 'no_click_challenge', icon: '🚫', title: 'No Click Challenge', description: 'Earn 1 million points without clicking', reward: 'Permanent +1% to autoclickers', progress: 0, target: 1e6, active: false, completed: false },
  { id: 'speed_click_challenge', icon: '⚡', title: 'Speed Click Challenge', description: 'Click 100 times in 10 seconds', reward: 'Permanent +1% to click power', progress: 0, target: 100, active: false, completed: false },
  { id: 'research_challenge', icon: '🔬', title: 'Research Sprint', description: 'Complete 5 research projects', reward: 'Permanent +10% to research efficiency', progress: 0, target: 5, active: false, completed: false },
  { id: 'upgrade_challenge', icon: '🔼', title: 'Upgrade Master', description: 'Purchase 20 upgrades in one session', reward: 'Permanent +5% to upgrade effectiveness', progress: 0, target: 20, active: false, completed: false }
];

// Events
let currentEvent = null;
let eventEndTime = 0;
let eventDuration = 0;
let eventActive = false;
let eventRewards = [];

// Shop items
let prestigeShopItems = [
  { id: 'prestige_crit', icon: '💥', title: 'Critical Boost', description: 'Increase critical hit chance by 1%', cost: 1, unlocked: true, purchased: false },
  { id: 'prestige_golden', icon: '🌟', title: 'Golden Boost', description: 'Increase golden time chance by 0.01%', cost: 2, unlocked: false, purchased: false },
  { id: 'prestige_research', icon: '🔬', title: 'Research Boost', description: 'Research projects cost 10% less', cost: 4, unlocked: false, purchased: false },
  { id: 'prestige_automation', icon: '⚙️', title: 'Automation Unlock', description: 'Unlock automation features', cost: 7, unlocked: false, purchased: false }
];

let cosmicShopItems = [
  { id: 'cosmic_crit', icon: '💥', title: 'Cosmic Critical', description: 'Critical hits are 2x more powerful', cost: 1, unlocked: true, purchased: false },
  { id: 'cosmic_golden', icon: '🌟', title: 'Cosmic Golden', description: 'Golden time lasts 2x longer', cost: 3, unlocked: false, purchased: false },
  { id: 'cosmic_multiplier', icon: '⚡', title: 'Cosmic Multiplier', description: 'Unlock advanced multiplier features', cost: 5, unlocked: false, purchased: false }
];

let ascensionShopItems = [
  { id: 'ascension_ultimate', icon: '💎', title: 'Ultimate Power', description: 'Unlock ultimate enhancement features', cost: 1, unlocked: true, purchased: false },
  { id: 'ascension_special', icon: '🌟', title: 'Special Features', description: 'Unlock all special visual features', cost: 3, unlocked: false, purchased: false }
];

// Game state object for achievements
const game = {
  get score() { return score; },
  get baseMultiplier() { return baseMultiplier; },
  get factoryLevel() { return factoryLevel; },
  get bankLevel() { return bankLevel; },
  get hotelLevel() { return hotelLevel; },
  get shopLevel() { return shopLevel; },
  get autoclickerLevel() { return autoclickerLevel; },
  get prestigeLevel() { return prestigeLevel; },
  get ascensionLevel() { return ascensionLevel; },
  get cosmicLevel() { return cosmicLevel; },
  get clicks() { return clicks; },
  get fullResets() { return fullResets; },
  get criticalHits() { return criticalHits; },
  get goldenTimeExperienced() { return goldenTimeExperienced; },
  get rainbowCrits() { return rainbowCrits; },
  get minigamesCompleted() { return minigamesCompleted; },
  get researchCompleted() { return researchCompleted; },
  get challengesCompleted() { return challengesCompleted; },
  get eventsParticipated() { return eventsParticipated; },
  get prestigeShopPurchases() { return prestigeShopPurchases; },
  get cosmicShopPurchases() { return cosmicShopPurchases; },
  get ascensionShopPurchases() { return ascensionShopPurchases; },
  get elementalsUnlocked() { return elementalsUnlocked; },
  get maxOfflineTime() { return maxOfflineTime; },
  get upgradesUnlocked() { return upgradesUnlocked; },
  get automationUnlocked() { return automationFeatures.filter(f => f.unlocked).length; }
};

// Format Number with scientific notation
function toScientific(num, digits) {
  return parseFloat(num).toExponential(digits);
}

function formatNumber(n) {
  if (n >= 1e93) return toScientific(n, 3);
  if (n >= 1e90) return (n / 1e90).toFixed(2)+"NV";
  if (n >= 1e87) return (n / 1e87).toFixed(2)+"oV";
  if (n >= 1e84) return (n / 1e84).toFixed(2)+"SV";
  if (n >= 1e81) return (n / 1e81).toFixed(2)+"sV";
  if (n >= 1e78) return (n / 1e78).toFixed(2)+"QV";
  if (n >= 1e75) return (n / 1e75).toFixed(2)+"qV";
  if (n >= 1e72) return (n / 1e72).toFixed(2)+"TV";
  if (n >= 1e69) return (n / 1e69).toFixed(2)+"DV";
  if (n >= 1e66) return (n / 1e66).toFixed(2)+"UV";
  if (n >= 1e63) return (n / 1e63).toFixed(2)+"V";
  if (n >= 1e60) return (n / 1e60).toFixed(2)+'Nd';
  if (n >= 1e57) return (n / 1e57).toFixed(2)+'od';
  if (n >= 1e54) return (n / 1e54).toFixed(2)+'Sd';
  if (n >= 1e51) return (n / 1e51).toFixed(2)+'sd';
  if (n >= 1e48) return (n / 1e48).toFixed(2)+'Qd';
  if (n >= 1e45) return (n / 1e45).toFixed(2)+'qd';
  if (n >= 1e42) return (n / 1e42).toFixed(2)+'Td';
  if (n >= 1e39) return (n / 1e39).toFixed(2)+'Dd';
  if (n >= 1e36) return (n / 1e36).toFixed(2)+'U';
  if (n >= 1e33) return (n / 1e33).toFixed(2)+'D';
  if (n >= 1e30) return (n / 1e30).toFixed(2)+'N';
  if (n >= 1e27) return (n / 1e27).toFixed(2)+'o';
  if (n >= 1e24) return (n / 1e24).toFixed(2)+'S';
  if (n >= 1e21) return (n / 1e21).toFixed(2)+'s';
  if (n >= 1e18) return (n / 1e18).toFixed(2)+'Q';
  if (n >= 1e15) return (n / 1e15).toFixed(2)+'q';
  if (n >= 1e12) return (n / 1e12).toFixed(2)+'T';
  if (n >= 1e9) return (n / 1e9).toFixed(2)+'B';
  if (n >= 1e6) return (n / 1e6).toFixed(2)+'M';
  return Math.round(n).toLocaleString();
}

// ----- Click Effects -----
function createClickEffect(x, y, isCritical = false, isRainbow = false) {
  if (isCritical) {
    const crit = document.createElement('div');
    crit.className = 'critical-hit';
    crit.textContent = isRainbow ? 'RAINBOW CRIT!' : 'CRITICAL!';
    crit.style.left = `${x}px`;
    crit.style.top = `${y}px`;
    
    if (isRainbow) {
      crit.classList.add('rainbow-text');
    }
    
    document.body.appendChild(crit);
    
    setTimeout(() => {
      crit.remove();
    }, 1500);
  } else {
    // Create multiple particles for normal click
    for (let i = 0; i < 8; i++) {
      const effect = document.createElement('div');
      effect.className = 'click-effect';
      effect.style.left = `${x}px`;
      effect.style.top = `${y}px`;
      effect.style.setProperty('--tx', `${Math.random() * 120 - 60}px`);
      effect.style.setProperty('--ty', `${Math.random() * 120 - 60}px`);
      document.body.appendChild(effect);
      
      setTimeout(() => {
        effect.remove();
      }, 1200);
    }
  }
}

function createFloatingText(x, y, text, colorClass = '') {
  const floating = document.createElement('div');
  floating.className = `floating-text ${colorClass}`;
  floating.textContent = text;
  floating.style.left = `${x}px`;
  floating.style.top = `${y}px`;
  floating.style.fontSize = '1.5em';
  document.body.appendChild(floating);
  
  setTimeout(() => {
    floating.remove();
  }, 2000);
}

// ----- Golden Time System -----
function activateGoldenTime() {
  goldenTimeActive = true;
  const duration = goldenTimeDuration * getGoldenTimeMultiplier();
  goldenTimeEnd = Date.now() + duration;
  goldenTimeExperienced++;
  
  const indicator = document.getElementById('goldenTimeIndicator');
  indicator.style.display = 'block';
  indicator.textContent = `✨ GOLDEN TIME! ${getGoldenTimeMultiplier()}x Points! ✨`;
  
  document.getElementById('mainBtn').classList.add('golden-skull');
  
  showNotification(`🌟 Golden Time Activated! Points are multiplied by ${getGoldenTimeMultiplier()}x!`, '🌟');
  
  checkAchievements();
  
  setTimeout(() => {
    if (goldenTimeActive) {
      endGoldenTime();
    }
  }, duration);
}

function endGoldenTime() {
  goldenTimeActive = false;
  
  document.getElementById('goldenTimeIndicator').style.display = 'none';
  document.getElementById('mainBtn').classList.remove('golden-skull');
  
  showNotification('Golden Time has ended.', '⏱️');
}

function checkGoldenTime() {
  if (goldenTimeActive && Date.now() >= goldenTimeEnd) {
    endGoldenTime();
  }
}

function getGoldenTimeMultiplier() {
  let multiplier = 2;
  
  // Apply multiplier features
  const goldenMult = multiplierFeatures.find(f => f.id === 'golden_multiplier');
  if (goldenMult && goldenMult.level > 0) {
    multiplier *= Math.pow(goldenMult.multiplier, goldenMult.level);
  }
  
  // Apply cosmic shop bonus
  if (cosmicShopItems.find(i => i.id === 'cosmic_golden')?.purchased) {
    multiplier *= 2;
  }
  
  return multiplier;
}

// ----- Notification System -----
function showNotification(message, icon = 'ℹ️') {
  const notificationArea = document.getElementById('notificationArea');
  const notification = document.createElement('div');
  notification.className = 'notification';
  notification.innerHTML = `<span class="icon">${icon}</span> ${message}`;
  notificationArea.appendChild(notification);
  
  setTimeout(() => {
    notification.classList.add('show');
  }, 10);
  
  setTimeout(() => {
    notification.classList.remove('show');
    
    setTimeout(() => {
      notification.remove();
    }, 300);
  }, 4000);
}

// ----- Research System -----
function renderResearch() {
  const container = document.getElementById('researchGrid');
  container.innerHTML = '';
  
  researchProjects.forEach(project => {
    if (project.unlocked && !project.completed) {
      const card = document.createElement('div');
      card.className = 'research-card';
      card.innerHTML = `
        <div class="icon">${project.icon}</div>
        <div class="title">${project.title}</div>
        <div class="description">${project.description}</div>
        <div class="cost">Cost: ${formatNumber(project.cost)}</div>
        ${project.unlockInfo ? `<div class="unlock-info">${project.unlockInfo}</div>` : ''}
      `;
      
      card.addEventListener('click', () => {
        if (score >= project.cost) {
          score -= project.cost;
          project.completed = true;
          researchCompleted++;
          
          // Handle upgrade unlocking research
          if (project.id.startsWith('upgrade_research_')) {
            const researchNumber = parseInt(project.id.split('_')[2]);
            upgradesUnlocked = Math.min(48, 3 + (researchNumber * 3));
            showNotification(`🔬 Research completed! Unlocked ${Math.min(3, 48 - upgradesUnlocked + 3)} new upgrades!`, '🔬');
            updateUpgradeCounter();
            renderUpgrades();
            
            // Unlock next research
            const nextResearch = researchProjects.find(r => r.id === `upgrade_research_${researchNumber + 1}`);
            if (nextResearch) {
              nextResearch.unlocked = true;
            }
          }
          
          // Apply other research effects
          switch(project.id) {
            case 'critical_research':
              criticalHitChance += 0.01;
              break;
            case 'golden_research':
              goldenTimeChance += 0.0001;
              break;
            case 'autoclicker_research':
              break; // Effect applied in calculation
            case 'factory_research':
              break; // Effect applied in calculation
          }
          
          // Unlock more research projects
          if (researchCompleted === 1) {
            researchProjects.find(r => r.id === 'golden_research').unlocked = true;
          }
          if (researchCompleted === 3) {
            researchProjects.find(r => r.id === 'autoclicker_research').unlocked = true;
            researchProjects.find(r => r.id === 'factory_research').unlocked = true;
          }
          
          renderResearch();
          updateAll();
          checkAchievements();
          autoSave();
          showNotification(`Completed ${project.title} research!`, '🔬');
        } else {
          showNotification('Not enough points for this research!', '❌');
        }
      });
      
      container.appendChild(card);
    }
  });
}

// ----- Upgrade System with Research Unlock -----
function updateUpgradeCounter() {
  const counter = document.getElementById('upgradeCounter');
  if (counter) {
    counter.textContent = `${upgradesUnlocked}/48`;
  }
}

function renderUpgrades() {
  const upgradeGrid = document.getElementById('upgradeGrid');
  upgradeGrid.innerHTML = '';
  
  upgrades.forEach((u, idx) => {
    const btn = document.createElement('button');
    const isUnlocked = idx < upgradesUnlocked;
    
    btn.className = `upgrade small tier-${u.tier}${isUnlocked ? '' : ' locked'}`;
    btn.innerHTML = `
      <span class="icon">${u.icon}</span>
      <span>+${formatNumber(u.power)} Power</span>
      <span class="cost">Cost: ${formatNumber(u.cost)}</span>
    `;
    
    if (!isUnlocked) {
      btn.innerHTML += `<div style="position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.7); color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.7em;">🔒</div>`;
    }
    
    const tooltip = document.createElement('div');
    tooltip.className = 'tooltip';
    tooltip.textContent = isUnlocked ? u.description : `Unlock with research (Requirement: ${u.unlockRequirement + 1} research completed)`;
    btn.appendChild(tooltip);
    
    btn.addEventListener('mouseenter', () => {
      tooltip.classList.add('show');
    });
    
    btn.addEventListener('mouseleave', () => {
      tooltip.classList.remove('show');
    });
    
    if (isUnlocked) {
      btn.addEventListener('click', () => {
        if (score >= u.cost) {
          score -= u.cost;
          const num = parseFloat(u.power.replace(/[^0-9.e+]/g, ''));
          baseMultiplier += num;
          u.cost = Math.ceil(u.cost * 1.15);
          updateUpgradeButton(btn, u, true);
          updateAll();
          checkAchievements();
          autoSave();
          showNotification(`Purchased ${u.icon} ${u.power} Power Upgrade!`, '🔼');
          
          const rect = btn.getBoundingClientRect();
          createFloatingText(
            rect.left + rect.width / 2,
            rect.top + rect.height / 2,
            `+${u.power}`,
            'elemental-fire'
          );
        } else {
          showNotification('Not enough points for this upgrade!', '❌');
        }
      });
    }
    
    upgradeGrid.appendChild(btn);
  });
}

function updateUpgradeButton(btn, upgrade, isUnlocked) {
  if (isUnlocked) {
    btn.innerHTML = `
      <span class="icon">${upgrade.icon}</span>
      <span>${upgrade.power} Power</span>
      <span class="cost">Cost: ${formatNumber(upgrade.cost)}</span>
    `;
  }
}

// ----- Automation System -----
function renderAutomation() {
  const container = document.getElementById('automationGrid');
  container.innerHTML = '';
  
  automationFeatures.forEach(feature => {
    if (feature.unlocked) {
      const card = document.createElement('div');
      card.className = 'automation-card';
      card.innerHTML = `
        <div class="icon">${feature.icon}</div>
        <div class="title">${feature.title}</div>
        <div class="description">${feature.description}</div>
        <div class="cost">Level: ${feature.level}/${feature.maxLevel}<br>Cost: ${formatNumber(feature.cost * Math.pow(2, feature.level))}</div>
        <div style="margin-top: 10px;">
          <button style="padding: 8px 16px; margin: 5px; border: none; border-radius: 8px; background: ${feature.active ? '#e74c3c' : '#27ae60'}; color: white; cursor: pointer; font-weight: bold;">
            ${feature.active ? 'Disable' : 'Enable'}
          </button>
        </div>
      `;
      
      card.addEventListener('click', (e) => {
        if (e.target.tagName === 'BUTTON') {
          feature.active = !feature.active;
          renderAutomation();
          showNotification(`${feature.title} ${feature.active ? 'enabled' : 'disabled'}!`, feature.icon);
        } else if (feature.level < feature.maxLevel) {
          const cost = feature.cost * Math.pow(2, feature.level);
          if (score >= cost) {
            score -= cost;
            feature.level++;
            renderAutomation();
            updateAll();
            autoSave();
            showNotification(`Upgraded ${feature.title} to level ${feature.level}!`, feature.icon);
          } else {
            showNotification('Not enough points for this automation upgrade!', '❌');
          }
        }
      });
      
      container.appendChild(card);
    }
  });
}

// ----- Multiplier System -----
function renderMultipliers() {
  const container = document.getElementById('multiplierGrid');
  container.innerHTML = '';
  
  multiplierFeatures.forEach(feature => {
    if (feature.unlocked) {
      const card = document.createElement('div');
      card.className = 'multiplier-card';
      const currentMultiplier = Math.pow(feature.multiplier, feature.level);
      card.innerHTML = `
        <div class="icon">${feature.icon}</div>
        <div class="title">${feature.title}</div>
        <div class="description">${feature.description}</div>
        <div class="cost">Level: ${feature.level}/${feature.maxLevel}<br>
        Current: x${currentMultiplier.toFixed(2)}<br>
        Cost: ${formatNumber(feature.cost * Math.pow(5, feature.level))}</div>
      `;
      
      if (feature.level < feature.maxLevel) {
        card.addEventListener('click', () => {
          const cost = feature.cost * Math.pow(5, feature.level);
          if (score >= cost) {
            score -= cost;
            feature.level++;
            renderMultipliers();
            updateAll();
            autoSave();
            showNotification(`Upgraded ${feature.title} to level ${feature.level}!`, feature.icon);
          } else {
            showNotification('Not enough points for this multiplier upgrade!', '❌');
          }
        });
      } else {
        card.style.opacity = '0.7';
        card.style.cursor = 'not-allowed';
      }
      
      container.appendChild(card);
    }
  });
}

// ----- Special Features System -----
function renderSpecialFeatures() {
  const container = document.getElementById('specialGrid');
  container.innerHTML = '';
  
  specialFeatures.forEach(feature => {
    if (feature.unlocked) {
      const card = document.createElement('div');
      card.className = 'special-card';
      card.innerHTML = `
        <div class="icon">${feature.icon}</div>
        <div class="title">${feature.title}</div>
        <div class="description">${feature.description}</div>
        <div class="cost">${feature.purchased ? 'OWNED' : 'Cost: ' + formatNumber(feature.cost)}</div>
      `;
      
      if (!feature.purchased) {
        card.addEventListener('click', () => {
          if (score >= feature.cost) {
            score -= feature.cost;
            feature.purchased = true;
            renderSpecialFeatures();
            updateAll();
            autoSave();
            showNotification(`Purchased ${feature.title}!`, feature.icon);
          } else {
            showNotification('Not enough points for this special feature!', '❌');
          }
        });
      } else {
        card.style.opacity = '0.7';
        card.style.cursor = 'not-allowed';
      }
      
      container.appendChild(card);
    }
  });
}

// Add these functions to handle the new shop items:
function buyPrestigeItem(itemId) {
    const item = prestigeShopItems.find(i => i.id === itemId);
    if (!item || item.purchased || !item.unlocked) return;
    
    if (prestigeLevel >= item.cost) {
        item.purchased = true;
        prestigeShopPurchases++;
        
        switch(item.id) {
            case 'prestige_click_power':
                baseMultiplier *= 1.25;
                break;
            case 'prestige_factory_boost':
                // Effect applied in calculations
                break;
            case 'prestige_bank_interest':
                // Effect applied in calculations
                break;
            case 'prestige_hotel_boost':
                // Effect applied in calculations
                break;
            case 'prestige_shop_discount':
                // Effect applied in calculations
                break;
            case 'prestige_autoclicker_boost':
                // Effect applied in calculations
                break;
            case 'prestige_crit_power':
                criticalHitMultiplier *= 1.5;
                break;
            case 'prestige_golden_duration':
                goldenTimeDuration *= 1.25;
                break;
            case 'prestige_rainbow_chance':
                rainbowCritChance += 0.0005;
                break;
            case 'prestige_offline_earnings':
                // Effect applied in offline calculations
                break;
        }
        
        updateAll();
        autoSave();
        showNotification(`Purchased ${item.title}!`, '🛍️');
    } else {
        showNotification('Not enough Prestige Points!', '❌');
    }
}

function buyCosmicItem(itemId) {
    const item = cosmicShopItems.find(i => i.id === itemId);
    if (!item || item.purchased || !item.unlocked) return;
    
    if (cosmicLevel >= item.cost) {
        item.purchased = true;
        cosmicShopPurchases++;
        
        switch(item.id) {
            case 'cosmic_click_fusion':
                // Effect needs implementation
                break;
            case 'cosmic_time_warp':
                // Effect needs implementation
                break;
            case 'cosmic_dimensional_shift':
                // Effect needs implementation
                break;
            case 'cosmic_quantum_entanglement':
                // Effect needs implementation
                break;
            case 'cosmic_black_hole':
                // Effect needs implementation
                break;
            case 'cosmic_nebula_boost':
                // Effect needs implementation
                break;
            case 'cosmic_supernova':
                // Effect needs implementation
                break;
            case 'cosmic_galactic_network':
                automationFeatures.forEach(f => f.level = Math.min(f.level + 1, f.maxLevel));
                break;
            case 'cosmic_wormhole':
                // Effect needs implementation
                break;
            case 'cosmic_multiversal_link':
                // Effect needs implementation
                break;
            case 'cosmic_omnipotence':
                // Effect needs implementation
                break;
        }
        
        updateAll();
        autoSave();
        showNotification(`Purchased ${item.title}!`, '🌠');
    } else {
        showNotification('Not enough Cosmic Points!', '❌');
    }
}

function buyAscensionItem(itemId) {
    const item = ascensionShopItems.find(i => i.id === itemId);
    if (!item || item.purchased || !item.unlocked) return;
    
    if (ascensionLevel >= item.cost) {
        item.purchased = true;
        ascensionShopPurchases++;
        
        switch(item.id) {
            case 'ascension_transcendence':
                // Effect needs implementation
                break;
            case 'ascension_divine_intervention':
                // Effect needs implementation
                break;
            case 'ascension_demonic_pact':
                // Effect needs implementation
                break;
            case 'ascension_eternal_flame':
                // Effect needs implementation
                break;
            case 'ascension_infinity_gauntlet':
                // Effect needs implementation
                break;
            case 'ascension_reality_stone':
                // Effect needs implementation
                break;
            case 'ascension_time_stone':
                // Effect needs implementation
                break;
            case 'ascension_mind_stone':
                // Effect needs implementation
                break;
            case 'ascension_soul_stone':
                // Effect needs implementation
                break;
            case 'ascension_power_stone':
                // Effect needs implementation
                break;
            case 'ascension_space_stone':
                // Effect needs implementation
                break;
            case 'ascension_ascended_being':
                // Effect needs implementation
                break;
        }
        
        updateAll();
        autoSave();
        showNotification(`Purchased ${item.title}!`, '✨');
    } else {
        showNotification('Not enough Ascension Points!', '❌');
    }
}

// ----- Achievements System -----
function renderAchievements() {
  const container = document.getElementById('achievementsList');
  container.innerHTML = "";
  achievements.forEach(ach => {
    const el = document.createElement('div');
    el.className = 'achievement' + (ach.unlocked ? ' unlocked' : '');
    
    const progress = ach.progress ? ach.progress(game) : 0;
    const progressBar = ach.progress && !ach.unlocked ? `
      <div class="achievement-progress">
        <div class="achievement-progress-fill" style="width: ${progress * 100}%"></div>
      </div>
    ` : '';
    
    el.innerHTML = `
      <span class="icon">${ach.icon}</span>
      <div class="achievement-text">
        <div class="achievement-title">${ach.title}</div>
        <div class="achievement-description">${ach.description}</div>
        ${progressBar}
      </div>
    `;
    
    if (!ach.unlocked) {
      const tooltip = document.createElement('div');
      tooltip.className = 'tooltip';
      tooltip.textContent = `Progress: ${Math.round(progress * 100)}%`;
      el.appendChild(tooltip);
      
      el.addEventListener('mouseenter', () => {
        tooltip.classList.add('show');
      });
      
      el.addEventListener('mouseleave', () => {
        tooltip.classList.remove('show');
      });
    }
    
    container.appendChild(el);
  });
}

function showAchievementPopup(ach) {
  const popup = document.getElementById('achievementPopup');
  popup.innerHTML = `
    <span class="icon">${ach.icon}</span>
    <span class="title">🎉 Achievement Unlocked! 🎉</span>
    <div class="description"><strong>${ach.title}:</strong> ${ach.description}</div>
  `;
  popup.style.display = 'block';
  
  createParticleExplosion(window.innerWidth / 2, 100);
  
  setTimeout(() => {
    popup.style.display = 'none';
  }, 4000);
}

function createParticleExplosion(x, y) {
  const colors = ['#e74c3c', '#f39c12', '#f1c40f', '#2ecc71', '#3498db', '#9b59b6'];
  
  for (let i = 0; i < 20; i++) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    particle.style.position = 'fixed';
    particle.style.left = x + 'px';
    particle.style.top = y + 'px';
    particle.style.width = '8px';
    particle.style.height = '8px';
    particle.style.borderRadius = '50%';
    particle.style.background = colors[Math.floor(Math.random() * colors.length)];
    particle.style.pointerEvents = 'none';
    particle.style.zIndex = '10000';
    
    const angle = (Math.PI * 2 * i) / 20;
    const velocity = 100 + Math.random() * 50;
    const tx = Math.cos(angle) * velocity;
    const ty = Math.sin(angle) * velocity;
    
    particle.style.setProperty('--tx', tx + 'px');
    particle.style.setProperty('--ty', ty + 'px');
    
    document.body.appendChild(particle);
    
    setTimeout(() => {
      particle.remove();
    }, 2500);
  }
}

function checkAchievements() {
  let anyNew = false;
  achievements.forEach(ach => {
    if (!ach.unlocked && ach.condition(game)) {
      ach.unlocked = true;
      showAchievementPopup(ach);
      anyNew = true;
    }
  });
  if (anyNew) renderAchievements();
}

// ----- Facilities -----
const factoryBtn = document.getElementById('factoryBtn');
function getFactoryCost(level) { return Math.pow((level + 9), 13) / 1e7; }
function updateFactoryInfo() {
  document.getElementById('factoryInfo').innerHTML = `Factory Level: ${factoryLevel}<br>Benefit: +${factoryLevel * 20}%`;
}
factoryBtn.addEventListener('click', () => {
  if (factoryLevel >= maxLevel) {
    showNotification('Factory is at maximum level!', '🏭');
    return;
  }
  const cost = getFactoryCost(factoryLevel + 1);
  if (score >= cost) {
    score -= cost;
    factoryLevel++;
    updateFactoryInfo();
    updateAll();
    checkAchievements();
    autoSave();
    showNotification(`Factory upgraded to level ${factoryLevel}! (+${factoryLevel * 20}%)`, '🏭');
    
    const rect = factoryBtn.getBoundingClientRect();
    createFloatingText(
      rect.left + rect.width / 2,
      rect.top + rect.height / 2,
      `+1 Level`,
      'elemental-metal'
    );
  } else {
    showNotification('Not enough points to upgrade Factory!', '❌');
  }
});

const bankBtn = document.getElementById('bankBtn');
function getBankCost(level) { return Math.pow((level + 9), 15) / 1e3; }
function updateBankInfo() {
  document.getElementById('bankInfo').innerHTML = `Bank Level: ${bankLevel}<br>Benefit: +${bankLevel * 30}%`;
}
bankBtn.addEventListener('click', () => {
  if (bankLevel >= maxLevel) {
    showNotification('Bank is at maximum level!', '🏦');
    return;
  }
  const cost = getBankCost(bankLevel + 1);
  if (score >= cost) {
    score -= cost;
    bankLevel++;
    updateBankInfo();
    updateAll();
    checkAchievements();
    autoSave();
    showNotification(`Bank upgraded to level ${bankLevel}! (+${bankLevel * 30}%)`, '🏦');
    
    const rect = bankBtn.getBoundingClientRect();
    createFloatingText(
      rect.left + rect.width / 2,
      rect.top + rect.height / 2,
      `+1 Level`,
      'elemental-money'
    );
  } else {
    showNotification('Not enough points to upgrade Bank!', '❌');
  }
});

const hotelBtn = document.getElementById('hotelBtn');
function getHotelCost(level) { return Math.pow((level + 9), 17) * 10; }
function updateHotelInfo() {
  document.getElementById('hotelInfo').innerHTML = `Hotel Level: ${hotelLevel}<br>Benefit: +${hotelLevel * 45}%`;
}
hotelBtn.addEventListener('click', () => {
  if (hotelLevel >= maxLevel) {
    showNotification('Hotel is at maximum level!', '🏨');
    return;
  }
  const cost = getHotelCost(hotelLevel + 1);
  if (score >= cost) {
    score -= cost;
    hotelLevel++;
    updateHotelInfo();
    updateAll();
    checkAchievements();
    autoSave();
    showNotification(`Hotel upgraded to level ${hotelLevel}! (+${hotelLevel * 45}%)`, '🏨');
    
    const rect = hotelBtn.getBoundingClientRect();
    createFloatingText(
      rect.left + rect.width / 2,
      rect.top + rect.height / 2,
      `+1 Level`,
      'elemental-life'
    );
  } else {
    showNotification('Not enough points to upgrade Hotel!', '❌');
  }
});

const shopBtn = document.getElementById('shopBtn');
function getShopUpgradeCost(level) { return Math.pow((level + 9), 19) * 1e5; }
function updateShopInfo() {
  document.getElementById('shopInfo').innerHTML = `Shop Level: ${shopLevel}<br>Benefit: +${shopLevel * 60}%`;
}
shopBtn.addEventListener('click', () => {
  if (shopLevel >= 100) {
    showNotification('Shop is at maximum level!', '🏪');
    return;
  }
  const cost = getShopUpgradeCost(shopLevel + 1);
  if (score >= cost) {
    score -= cost;
    shopLevel++;
    updateShopInfo();
    updateAll();
    checkAchievements();
    autoSave();
    showNotification(`Shop upgraded to level ${shopLevel}! (+${shopLevel * 60}%)`, '🏪');
    
    const rect = shopBtn.getBoundingClientRect();
    createFloatingText(
      rect.left + rect.width / 2,
      rect.top + rect.height / 2,
      `+1 Level`,
      'elemental-tech'
    );
  } else {
    showNotification('Not enough points to upgrade Shop!', '❌');
  }
});

// ----- Autoclicker -----
const autoclickerMaxLevel = 200;
function getAutoclickerCost(level) {
  return Math.round(autoclickerBaseCost * Math.pow(1.3, level));
}
function getAutoclickerEffectPerSec() {
    if (autoclickerLevel === 0) return 0;
    
    let baseEffect = autoclickerLevel * 0.03;
    
    // Apply research bonus
    if (researchProjects.find(p => p.id === 'autoclicker_research')?.completed) {
        baseEffect *= 1.10;
    }
    
    // Apply prestige shop bonus
    if (prestigeShopItems.find(i => i.id === 'prestige_autoclicker_boost' && i.purchased)) {
        baseEffect *= 1.20;
    }
    
    return getTotalMultiplier() * baseEffect;
} 

function updateAutoclickerInfo() {
  const effect = getAutoclickerEffectPerSec();
  let cost = getAutoclickerCost(autoclickerLevel + 1);
  let info = `Level: ${autoclickerLevel}/200<br>`;
  info += `Effect: +${formatNumber(effect)}/sec (${autoclickerLevel * 3}%)<br>`;
  info += autoclickerLevel < autoclickerMaxLevel
    ? `Cost: ${formatNumber(cost)}`
    : `Max Level`;
  document.getElementById('autoclickerInfo').innerHTML = info;

  const btn = document.getElementById('autoclickerBuyBtn');
  if (autoclickerLevel < autoclickerMaxLevel) {
    btn.textContent = `🤖 Buy Auto Clicker (${formatNumber(cost)})`;
    btn.disabled = false;
  } else {
    btn.textContent = `🤖 Max Level Reached!`;
    btn.disabled = true;
  }
}

document.getElementById('autoclickerBuyBtn').addEventListener('click', () => {
  const nextCost = getAutoclickerCost(autoclickerLevel + 1);
  if (autoclickerLevel >= autoclickerMaxLevel) return;
  if (score >= nextCost) {
    score -= nextCost;
    autoclickerLevel++;
    updateAutoclickerInfo();
    updateAll();
    checkAchievements();
    autoSave();
    showNotification(`Auto Clicker upgraded to level ${autoclickerLevel}!`, '🤖');
    
    const rect = document.getElementById('autoclickerBuyBtn').getBoundingClientRect();
    createFloatingText(
      rect.left + rect.width / 2,
      rect.top + rect.height / 2,
      `+1 Level`,
      'elemental-tech'
    );
  } else {
    showNotification('Not enough points to buy Auto Clicker!', '❌');
  }
});

// ----- Prestige -----
function getPrestigeBonus() {
  return Math.pow(3, prestigeLevel);
}
function updatePrestigeInfo() {
  const bonus = getPrestigeBonus();
  document.getElementById('prestigeInfo').innerHTML = `
    Level: ${prestigeLevel}/${prestigeMaxLevel}<br>
    Bonus Multiplier: x${bonus.toLocaleString()}<br>
    Cost: ${prestigeLevel < prestigeMaxLevel ? formatNumber(prestigeCost) : 'Max Level'}
  `;
  const btn = document.getElementById('prestigeBuyBtn');
  if (prestigeLevel >= prestigeMaxLevel) {
    btn.textContent = '👑 Max Prestige Level Reached!';
    btn.disabled = true;
  } else {
    btn.textContent = `👑 Buy Prestige (${formatNumber(prestigeCost)})`;
    btn.disabled = false;
  }
}

document.getElementById('prestigeBuyBtn').addEventListener('click', () => {
  if (prestigeLevel >= prestigeMaxLevel) return;
  if (score >= prestigeCost) {
    score -= prestigeCost;
    prestigeLevel++;
    prestigeCost *= 10000;
    resetOnPrestige();
    updatePrestigeInfo();
    updateAll();
    checkAchievements();
    autoSave();
    showNotification(`Prestiged to level ${prestigeLevel}! Multiplier: x${getPrestigeBonus()}`, '👑');
    
    const rect = document.getElementById('prestigeBuyBtn').getBoundingClientRect();
    createFloatingText(
      rect.left + rect.width / 2,
      rect.top + rect.height / 2,
      `Prestige +1`,
      'prestige-effect'
    );
    
    if (prestigeLevel === 1) {
      showNotification('Rainbow Critical Hits unlocked!', '🌈');
      rainbowCritChance = 0.001;
    }

    prestigeShopItems.forEach((item, index) => {
      if (index < prestigeLevel) {
        item.unlocked = true;
      }
    });
    
    // Unlock automation features
    if (prestigeLevel >= 5) {
      automationFeatures.forEach(f => f.unlocked = true);
    }
  } else {
    showNotification('Not enough points to Prestige!', '❌');
  }
});

// ----- Ascension -----
function getAscensionBonus() {
  return Math.pow(6, ascensionLevel);
}
function updateAscensionInfo() {
  const bonus = getAscensionBonus();
  document.getElementById('ascensionInfo').innerHTML = `
    Level: ${ascensionLevel}/${ascensionMaxLevel}<br>
    Bonus Multiplier: x${bonus.toLocaleString()}<br>
    Cost: ${ascensionLevel < ascensionMaxLevel ? formatNumber(ascensionCost) : 'Max Level'}
  `;
  const btn = document.getElementById('ascensionBuyBtn');
  if (ascensionLevel >= ascensionMaxLevel) {
    btn.textContent = '✨ Max Ascension Level Reached!';
    btn.disabled = true;
  } else {
    btn.textContent = `✨ Ascend (${formatNumber(ascensionCost)})`;
    btn.disabled = false;
  }
}

document.getElementById('ascensionBuyBtn').addEventListener('click', () => {
  if (ascensionLevel >= ascensionMaxLevel) return;
  if (score >= ascensionCost) {
    score -= ascensionCost;
    ascensionLevel++;
    ascensionCost *= 1e6;
    resetOnAscension();
    updateAscensionInfo();
    updateAll();
    checkAchievements();
    autoSave();
    showNotification(`Ascended to level ${ascensionLevel}! Multiplier: x${getAscensionBonus()}`, '✨');
    
    const rect = document.getElementById('ascensionBuyBtn').getBoundingClientRect();
    createFloatingText(
      rect.left + rect.width / 2,
      rect.top + rect.height / 2,
      `Ascension +1`,
      'ascended-effect'
    );

    ascensionShopItems.forEach((item, index) => {
      if (index < ascensionLevel) {
        item.unlocked = true;
      }
    });
    
    // Unlock multiplier features
    if (ascensionLevel >= 1) {
      multiplierFeatures.forEach((f, index) => {
        if (index <= ascensionLevel) f.unlocked = true;
      });
    }
  } else {
    showNotification('Not enough points to Ascend!', '❌');
  }
});

// ----- Cosmic Realm -----
function getCosmicBonus() {
  return Math.pow(12, cosmicLevel);
}
function updateCosmicInfo() {
  const bonus = getCosmicBonus();
  document.getElementById('cosmicInfo').innerHTML = `
    Level: ${cosmicLevel}/${cosmicMaxLevel}<br>
    Bonus Multiplier: x${bonus.toLocaleString()}<br>
    Cost: ${cosmicLevel < cosmicMaxLevel ? formatNumber(cosmicCost) : 'Max Level'}
  `;
  const btn = document.getElementById('cosmicBuyBtn');
  if (cosmicLevel >= cosmicMaxLevel) {
    btn.textContent = '🌌 Max Cosmic Level Reached!';
    btn.disabled = true;
  } else {
    btn.textContent = `🌌 Enter Cosmic Realm (${formatNumber(cosmicCost)})`;
    btn.disabled = false;
  }
}

document.getElementById('cosmicBuyBtn').addEventListener('click', () => {
  if (cosmicLevel >= cosmicMaxLevel) return;
  if (score >= cosmicCost) {
    score -= cosmicCost;
    cosmicLevel++;
    cosmicCost *= 1e9;
    resetOnCosmic();
    updateCosmicInfo();
    updateAll();
    checkAchievements();
    autoSave();
    showNotification(`Entered Cosmic Realm level ${cosmicLevel}! Multiplier: x${getCosmicBonus()}`, '🌌');
    
    const rect = document.getElementById('cosmicBuyBtn').getBoundingClientRect();
    createFloatingText(
      rect.left + rect.width / 2,
      rect.top + rect.height / 2,
      `Cosmic +1`,
      'cosmic-effect'
    );

    cosmicShopItems.forEach((item, index) => {
      if (index < cosmicLevel) {
        item.unlocked = true;
      }
    });
    
    // Unlock special features
    if (cosmicLevel >= 1) {
      specialFeatures.forEach((f, index) => {
        if (index <= cosmicLevel) f.unlocked = true;
      });
    }
  } else {
    showNotification('Not enough points to enter Cosmic Realm!', '❌');
  }
});

// ----- Shop Systems -----
function renderPrestigeShop() {
    const container = document.getElementById('prestigeShopGrid');
    if (!container) return;
    
    container.innerHTML = '';
    
    prestigeShopItems.forEach(item => {
        if (item.unlocked) {
            const card = document.createElement('div');
            card.className = `prestige-shop-item ${item.purchased ? 'purchased' : ''}`;
            card.innerHTML = `
                <div class="icon">${item.icon}</div>
                <div class="title">${item.title}</div>
                <div class="description">${item.description}</div>
                <div class="cost">Cost: ${item.cost} Prestige Points</div>
                ${item.purchased ? '<div class="shop-item-purchased">✓</div>' : ''}
            `;
            
            if (!item.purchased) {
                card.addEventListener('click', () => buyPrestigeItem(item.id));
            } else {
                card.style.opacity = '0.5';
                card.style.cursor = 'not-allowed';
            }
            
            container.appendChild(card);
        }
    });
}

function renderCosmicShop() {
  const container = document.getElementById('cosmicShopGrid');
  container.innerHTML = '';
  
  cosmicShopItems.forEach(item => {
    if (item.unlocked) {
      const card = document.createElement('div');
      card.className = `cosmic-shop-item ${item.purchased ? 'purchased' : ''}`;
      card.innerHTML = `
        <div class="icon">${item.icon}</div>
        <div class="title">${item.title}</div>
        <div class="description">${item.description}</div>
        <div class="cost">Cost: ${item.cost} Cosmic Points</div>
      `;
      
      if (!item.purchased) {
        card.addEventListener('click', () => {
          if (cosmicLevel >= item.cost) {
            item.purchased = true;
            cosmicShopPurchases++;
            
            switch(item.id) {
              case 'cosmic_multiplier':
                multiplierFeatures.forEach(f => f.unlocked = true);
                break;
            }
            
            renderCosmicShop();
            updateAll();
            checkAchievements();
            autoSave();
            showNotification(`Purchased ${item.title} from Cosmic Shop!`, '🌠');
          } else {
            showNotification('Not enough Cosmic Points for this item!', '❌');
          }
        });
      } else {
        card.style.opacity = '0.5';
        card.style.cursor = 'not-allowed';
      }
      
      container.appendChild(card);
    }
  });
}

function renderAscensionShop() {
  const container = document.getElementById('ascensionShopGrid');
  container.innerHTML = '';
  
  ascensionShopItems.forEach(item => {
    if (item.unlocked) {
      const card = document.createElement('div');
      card.className = `ascension-shop-item ${item.purchased ? 'purchased' : ''}`;
      card.innerHTML = `
        <div class="icon">${item.icon}</div>
        <div class="title">${item.title}</div>
        <div class="description">${item.description}</div>
        <div class="cost">Cost: ${item.cost} Ascension Points</div>
      `;
      
      if (!item.purchased) {
        card.addEventListener('click', () => {
          if (ascensionLevel >= item.cost) {
            item.purchased = true;
            ascensionShopPurchases++;
            
            switch(item.id) {
              case 'ascension_special':
                specialFeatures.forEach(f => f.unlocked = true);
                break;
            }
            
            renderAscensionShop();
            updateAll();
            checkAchievements();
            autoSave();
            showNotification(`Purchased ${item.title} from Ascension Shop!`, '✨');
          } else {
            showNotification('Not enough Ascension Points for this item!', '❌');
          }
        });
      } else {
        card.style.opacity = '0.5';
        card.style.cursor = 'not-allowed';
      }
      
      container.appendChild(card);
    }
  });
}

// ----- Minigames -----
function renderMinigames() {
  const container = document.getElementById('minigameGrid');
  container.innerHTML = '';
  
  minigames.forEach(game => {
    if (game.unlocked) {
      const card = document.createElement('div');
      card.className = 'minigame-card';
      card.innerHTML = `
        <div class="icon">${game.icon}</div>
        <div class="title">${game.title}</div>
        <div class="description">${game.description}</div>
        ${game.completed ? '<div class="badge badge-special">COMPLETED</div>' : ''}
      `;
      
      if (!game.completed) {
        card.addEventListener('click', () => {
          startMinigame(game.id);
        });
      }
      
      container.appendChild(card);
    }
  });
}

function startMinigame(id) {
  showNotification(`Starting ${id} minigame...`, '🎮');
  
  setTimeout(() => {
    const game = minigames.find(g => g.id === id);
    if (game && !game.completed) {
      game.completed = true;
      minigamesCompleted++;
      
      const reward = Math.floor(score * 0.1);
      score += reward;
      
      renderMinigames();
      updateAll();
      checkAchievements();
      autoSave();
      showNotification(`Completed ${game.title} minigame! Earned ${formatNumber(reward)} points!`, '🏆');
    }
  }, 2000);
}

// ----- Challenges -----
function renderChallenges() {
  const container = document.getElementById('challengeGrid');
  container.innerHTML = '';
  
  challenges.forEach(challenge => {
    const card = document.createElement('div');
    card.className = `challenge-card ${challenge.active ? 'active' : ''} ${challenge.completed ? 'completed' : ''}`;
    
    const progressPercent = Math.min(challenge.progress / challenge.target * 100, 100);
    
    card.innerHTML = `
      <div class="icon">${challenge.icon}</div>
      <div class="title">${challenge.title}</div>
      <div class="description">${challenge.description}</div>
      <div class="progress">
        <div class="progress-fill" style="width: ${progressPercent}%"></div>
      </div>
      ${challenge.completed ? 
        '<div class="reward">✅ Completed!</div>' : 
        `<div class="reward">Reward: ${challenge.reward}</div>`
      }
    `;
    
    if (!challenge.completed) {
      card.addEventListener('click', () => {
        if (!challenge.active) {
          challenge.active = true;
          renderChallenges();
          showNotification(`Started ${challenge.title} challenge!`, '🏅');
        } else {
          showNotification(`${challenge.title}: ${challenge.progress}/${challenge.target}`, challenge.icon);
        }
      });
    }
    
    container.appendChild(card);
  });
}

// ----- Events -----
function renderEvent() {
  const container = document.getElementById('currentEvent');
  
  if (currentEvent && eventActive) {
    const timeLeft = Math.max(0, eventEndTime - Date.now());
    const hours = Math.floor(timeLeft / (1000 * 60 * 60));
    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
    
    container.innerHTML = `
      <div class="event-banner">
        <div>🎉 ${currentEvent.name} 🎉</div>
        <div class="event-timer">⏱️ Time Left: ${hours}h ${minutes}m ${seconds}s</div>
      </div>
      <div style="padding: 20px;">${currentEvent.description}</div>
      <div class="event-rewards">
        ${eventRewards.map(reward => `
          <div class="event-reward">
            <div class="icon">${reward.icon}</div>
            <div class="name">${reward.name}</div>
            <div class="amount">${reward.amount}</div>
          </div>
        `).join('')}
      </div>
    `;
  } else {
    container.innerHTML = `
      <div style="text-align: center; padding: 30px;">
        <h3>🎉 No Active Events</h3>
        <p>Check back later for special events!</p>
      </div>
    `;
  }
}

// ----- Main Click Button -----
document.getElementById('mainBtn').addEventListener('click', function(e) {
  const isCritical = Math.random() < criticalHitChance;
  const isRainbow = isCritical && Math.random() < rainbowCritChance;
  let multiplier = isCritical ? criticalHitMultiplier : 1;
  
  if (isCritical) {
    if (cosmicShopItems.find(i => i.id === 'cosmic_crit')?.purchased) {
      multiplier *= 2;
    }
    if (isRainbow) {
      multiplier *= 3;
    }
  }
  
  const goldenMultiplier = goldenTimeActive ? getGoldenTimeMultiplier() : 1;
  
  let pointsGained = getTotalMultiplier() * goldenMultiplier * multiplier;
  
  // Apply click multiplier
  const clickMult = multiplierFeatures.find(f => f.id === 'click_multiplier');
  if (clickMult && clickMult.level > 0) {
    pointsGained *= Math.pow(clickMult.multiplier, clickMult.level);
  }
  
  score += pointsGained;
  clicks++;
  
  const rect = this.getBoundingClientRect();
  createClickEffect(e.clientX, e.clientY, isCritical, isRainbow);
  
  createFloatingText(
    e.clientX,
    e.clientY,
    `+${formatNumber(pointsGained)}`,
    isRainbow ? 'rainbow-text' : 
      isCritical ? 'critical-color' : 'money-effect'
  );
  
  if (!goldenTimeActive && Math.random() < goldenTimeChance) {
    activateGoldenTime();
  }
  
  if (isCritical) {
    criticalHits++;
    if (isRainbow) {
      rainbowCrits++;
      showNotification(`🌈 RAINBOW CRITICAL HIT! +${formatNumber(pointsGained)} points!`, '🌈');
    } else {
      showNotification(`💥 CRITICAL HIT! +${formatNumber(pointsGained)} points!`, '💥');
    }
  }
  
  updateAll();
  checkAchievements();
  autoSave();
});

// ----- Calculate Total Multiplier -----
function getTotalMultiplier() {
    let factoryFactor = 1 + (factoryLevel * 0.20);
    let bankFactor = 1 + (bankLevel * 0.30);
    let hotelFactor = 1 + (hotelLevel * 0.45);
    let shopFactor = 1 + (shopLevel * 0.60);
    
    // Apply prestige shop bonuses
    if (prestigeShopItems.find(i => i.id === 'prestige_factory_boost' && i.purchased)) {
        factoryFactor *= 1.15;
    }
    if (prestigeShopItems.find(i => i.id === 'prestige_bank_interest' && i.purchased)) {
        bankFactor *= 1.20;
    }
    if (prestigeShopItems.find(i => i.id === 'prestige_hotel_boost' && i.purchased)) {
        hotelFactor *= 1.25;
    }
    if (prestigeShopItems.find(i => i.id === 'prestige_shop_discount' && i.purchased)) {
        shopFactor *= 1.30;
    }
    
    // Apply research bonuses
    if (researchProjects.find(p => p.id === 'factory_research')?.completed) {
        factoryFactor *= 1.10;
    }
    
    // Apply facility multiplier
    const facilityMult = multiplierFeatures.find(f => f.id === 'facility_multiplier');
    if (facilityMult && facilityMult.level > 0) {
        const multiplier = Math.pow(facilityMult.multiplier, facilityMult.level);
        factoryFactor *= multiplier;
        bankFactor *= multiplier;
        hotelFactor *= multiplier;
        shopFactor *= multiplier;
    }
    
    return baseMultiplier * factoryFactor * bankFactor * hotelFactor * shopFactor * 
           getPrestigeBonus() * getAscensionBonus() * getCosmicBonus();
}

// ----- Update All UI -----
function updateAll() {
  document.getElementById('score').innerHTML = `${formatNumber(score)} <span class="score-decoration">💰 POINTS</span>`;

  const totalMultiplier = getTotalMultiplier();

  const statusHTML = `
    <strong>💰 Score:</strong> ${formatNumber(score)}<br>
    <strong>🔼 Base Multiplier:</strong> x${formatNumber(baseMultiplier)}<br>
    <strong>🔓 Upgrades Unlocked:</strong> ${upgradesUnlocked}/48<br>
    <strong>🏭 Factory Level:</strong> ${factoryLevel}/100 (+${(factoryLevel * 20)}%)<br>
    <strong>🏦 Bank Level:</strong> ${bankLevel}/100 (+${bankLevel * 30}%)<br>
    <strong>🏨 Hotel Level:</strong> ${hotelLevel}/100 (+${hotelLevel * 45}%)<br>
    <strong>🏪 Shop Level:</strong> ${shopLevel}/100 (+${shopLevel * 60}%)<br>
    <strong>👑 Prestige Level:</strong> ${prestigeLevel}/12 (Bonus x${getPrestigeBonus().toLocaleString()})<br>
    <strong>✨ Ascension Level:</strong> ${ascensionLevel}/5 (Bonus x${getAscensionBonus().toLocaleString()})<br>
    <strong>🌌 Cosmic Level:</strong> ${cosmicLevel}/3 (Bonus x${getCosmicBonus().toLocaleString()})<br>
    <strong>⚡ Total Multiplier:</strong> x${formatNumber(totalMultiplier)}<br>
    <strong>👆 Clicks:</strong> ${formatNumber(clicks)}<br>
    <strong>🤖 Auto Clicker:</strong> +${formatNumber(getAutoclickerEffectPerSec())}/sec<br>
    <strong>💥 Critical Chance:</strong> ${(criticalHitChance * 100).toFixed(2)}% (x${criticalHitMultiplier})<br>
    <strong>🌟 Golden Time Chance:</strong> ${(goldenTimeChance * 100).toFixed(4)}%<br>
    <strong>🔬 Research Completed:</strong> ${researchCompleted}<br>
    ${goldenTimeActive ? '<strong style="color: var(--golden-color);">✨ GOLDEN TIME ACTIVE! Points Multiplied! ✨</strong>' : ''}
    ${eventActive ? `<strong style="color: var(--elemental-fire);">🎉 EVENT ACTIVE: ${currentEvent.name}</strong>` : ''}
  `;
  document.getElementById('statsDisplay').innerHTML = statusHTML;

  updateFactoryInfo();
  updateBankInfo();
  updateHotelInfo();
  updateShopInfo();
  updateAutoclickerInfo();
  updatePrestigeInfo();
  updateAscensionInfo();
  updateCosmicInfo();
  updateUpgradeCounter();
  renderUpgrades();
  renderResearch();
  renderAutomation();
  renderMultipliers();
  renderSpecialFeatures();
  renderPrestigeShop();
  renderCosmicShop();
  renderAscensionShop();
  renderMinigames();
  renderChallenges();
  renderEvent();
}

// ----- Reset Functions -----
function resetOnPrestige() {
  score = 0;
  baseMultiplier = 1;
  factoryLevel = 0;
  bankLevel = 0;
  hotelLevel = 0;
  shopLevel = 0;
  autoclickerLevel = 0;
  autoclickerBaseCost = 100;
  clicks = 0;

  for (let i = 0; i < upgrades.length; i++) {
    upgrades[i].cost = baseUpgradeCosts[i];
  }
  
  challenges.forEach(c => {
    c.active = false;
    c.progress = 0;
  });
  
  updateFactoryInfo();
  updateBankInfo();
  updateHotelInfo();
  updateShopInfo();
  updateAutoclickerInfo();
}

function resetOnAscension() {
  resetOnPrestige();
  prestigeLevel = 0;
  prestigeCost = prestigeBaseCost;
  
  minigames.forEach(m => {
    if (m.id === 'memory_game' || m.id === 'timed_clicks') {
      m.unlocked = true;
    }
  });
}

function resetOnCosmic() {
  resetOnAscension();
  ascensionLevel = 0;
  ascensionCost = ascensionBaseCost;
  
  minigames.forEach(m => {
    if (m.id === 'number_guess' || m.id === 'reaction_test') {
      m.unlocked = true;
    }
  });
}

// ----- Cost update interval -----
let lastCostUpdate = 0;
setInterval(() => {
  const now = Date.now();
  
  // Only update costs every 500ms instead of 100ms
  if (now - lastCostUpdate > 500) {
    if (factoryLevel < maxLevel) {
      factoryBtn.textContent = `🏭 Buy Factory (${formatNumber(getFactoryCost(factoryLevel + 1))})`;
    } else {
      factoryBtn.textContent = `🏭 Factory max level!`;
      factoryBtn.disabled = true;
    }
    
    if (bankLevel < maxLevel) {
      bankBtn.textContent = `🏦 Upgrade Bank (${formatNumber(getBankCost(bankLevel + 1))})`;
    } else {
      bankBtn.textContent = `🏦 Bank max level!`;
      bankBtn.disabled = true;
    }
    
    if (hotelLevel < maxLevel) {
      hotelBtn.textContent = `🏨 Upgrade Hotel (${formatNumber(getHotelCost(hotelLevel + 1))})`;
    } else {
      hotelBtn.textContent = `🏨 Hotel max level!`;
      hotelBtn.disabled = true;
    }
    
    if (shopLevel < 100) {
      shopBtn.textContent = `🏪 Upgrade Shop (${formatNumber(getShopUpgradeCost(shopLevel + 1))})`;
    } else {
      shopBtn.textContent = `🏪 Shop max level!`;
      shopBtn.disabled = true;
    }
    
    lastCostUpdate = now;
  }
  
  checkGoldenTime();
  
  // Automation - run less frequently
  if (now % 200 === 0) { // Only run every 200ms
    automationFeatures.forEach(feature => {
      if (feature.active && feature.level > 0) {
        switch(feature.id) {
          case 'auto_buy_upgrades':
            // Auto buy cheapest upgrades
            const cheapestUpgrade = upgrades
              .map((u, i) => ({ upgrade: u, index: i }))
              .filter(({ index }) => index < upgradesUnlocked)
              .sort((a, b) => a.upgrade.cost - b.upgrade.cost)[0];
            
            if (cheapestUpgrade && score >= cheapestUpgrade.upgrade.cost) {
              const u = cheapestUpgrade.upgrade;
              score -= u.cost;
              const num = parseFloat(u.power.replace(/[^0-9.e+]/g, ''));
              baseMultiplier += num;
              u.cost = Math.ceil(u.cost * 1.15);
              
              // Update score display only
              document.getElementById('score').innerHTML = `${formatNumber(score)} <span class="score-decoration">💰 POINTS</span>`;
            }
            break;
        }
      }
    });
  }
}, 100);

// ----- Autoclicker points gain -----
let autoclickerRemainder = 0;
setInterval(() => {
  if (autoclickerLevel > 0) {
    const perSecondGain = getAutoclickerEffectPerSec() * (goldenTimeActive ? getGoldenTimeMultiplier() : 1);
    const per100MsGain = perSecondGain / 10;
    autoclickerRemainder += per100MsGain;
    const addPoints = Math.floor(autoclickerRemainder);
    if (addPoints > 0) {
      score += addPoints;
      autoclickerRemainder -= addPoints;
      
      // Only update score display, not everything
      document.getElementById('score').innerHTML = `${formatNumber(score)} <span class="score-decoration">💰 POINTS</span>`;
      
      // Only check achievements occasionally to reduce load
      if (Math.random() < 0.01) { // 1% chance per tick
        checkAchievements();
      }
      
      // Auto-save less frequently
      if (Math.random() < 0.002) { // 0.2% chance per tick
        autoSave();
      }
    }
  }
}, 100);

// ----- Save/Load logic -----
function getSaveData() {
  return {
    score,
    baseMultiplier,
    factoryLevel,
    bankLevel,
    hotelLevel,
    shopLevel,
    autoclickerLevel,
    prestigeLevel,
    prestigeCost,
    ascensionLevel,
    ascensionCost,
    cosmicLevel,
    cosmicCost,
    upgrades: upgrades.map(u => ({ cost: u.cost })),
    clicks,
    achievements: achievements.map(a => !!a.unlocked),
    lastSaved: Date.now(),
    fullResets,
    criticalHits,
    goldenTimeExperienced,
    goldenTimeActive,
    goldenTimeEnd,
    rainbowCrits,
    upgradesUnlocked,
    researchProjects: researchProjects.map(r => ({ unlocked: r.unlocked, completed: r.completed })),
    automationFeatures: automationFeatures.map(f => ({ unlocked: f.unlocked, level: f.level, active: f.active })),
    multiplierFeatures: multiplierFeatures.map(f => ({ unlocked: f.unlocked, level: f.level })),
    specialFeatures: specialFeatures.map(f => ({ unlocked: f.unlocked, purchased: f.purchased })),
    minigames: minigames.map(m => ({ unlocked: m.unlocked, completed: m.completed })),
    challenges: challenges.map(c => ({ active: c.active, completed: c.completed, progress: c.progress })),
    currentEvent: eventActive ? currentEvent : null,
    eventEndTime,
    eventDuration,
    eventActive,
    eventRewards,
    prestigeShopItems: prestigeShopItems.map(i => ({ unlocked: i.unlocked, purchased: i.purchased })),
    cosmicShopItems: cosmicShopItems.map(i => ({ unlocked: i.unlocked, purchased: i.purchased })),
    ascensionShopItems: ascensionShopItems.map(i => ({ unlocked: i.unlocked, purchased: i.purchased })),
    minigamesCompleted,
    researchCompleted,
    challengesCompleted,
    eventsParticipated,
    prestigeShopPurchases,
    cosmicShopPurchases,
    ascensionShopPurchases,
    elementalsUnlocked,
    maxOfflineTime,
    criticalHitChance,
    goldenTimeChance,
    rainbowCritChance
  };
}

function setSaveData(data) {
  if (!data || typeof data !== 'object') return;
  score = data.score || 0;
  baseMultiplier = data.baseMultiplier || 1;
  factoryLevel = data.factoryLevel || 0;
  bankLevel = data.bankLevel || 0;
  hotelLevel = data.hotelLevel || 0;
  shopLevel = data.shopLevel || 0;
  autoclickerLevel = data.autoclickerLevel || 0;
  prestigeLevel = data.prestigeLevel || 0;
  prestigeCost = data.prestigeCost || prestigeBaseCost;
  ascensionLevel = data.ascensionLevel || 0;
  ascensionCost = data.ascensionCost || ascensionBaseCost;
  cosmicLevel = data.cosmicLevel || 0;
  cosmicCost = data.cosmicCost || cosmicBaseCost;
  clicks = data.clicks || 0;
  upgradesUnlocked = data.upgradesUnlocked || 3;
  
  if (data.upgrades) {
    for (let i = 0; i < Math.min(upgrades.length, data.upgrades.length); i++) {
      upgrades[i].cost = data.upgrades[i].cost || baseUpgradeCosts[i];
    }
  }
  
  if (data.achievements) {
    for (let i = 0; i < Math.min(achievements.length, data.achievements.length); i++) {
      achievements[i].unlocked = data.achievements[i];
    }
  }
  
  if (data.researchProjects) {
    for (let i = 0; i < Math.min(researchProjects.length, data.researchProjects.length); i++) {
      researchProjects[i].unlocked = data.researchProjects[i].unlocked;
      researchProjects[i].completed = data.researchProjects[i].completed;
    }
  }
  
  if (data.automationFeatures) {
    for (let i = 0; i < Math.min(automationFeatures.length, data.automationFeatures.length); i++) {
      automationFeatures[i].unlocked = data.automationFeatures[i].unlocked;
      automationFeatures[i].level = data.automationFeatures[i].level;
      automationFeatures[i].active = data.automationFeatures[i].active;
    }
  }
  
  if (data.multiplierFeatures) {
    for (let i = 0; i < Math.min(multiplierFeatures.length, data.multiplierFeatures.length); i++) {
      multiplierFeatures[i].unlocked = data.multiplierFeatures[i].unlocked;
      multiplierFeatures[i].level = data.multiplierFeatures[i].level;
    }
  }
  
  if (data.specialFeatures) {
    for (let i = 0; i < Math.min(specialFeatures.length, data.specialFeatures.length); i++) {
      specialFeatures[i].unlocked = data.specialFeatures[i].unlocked;
      specialFeatures[i].purchased = data.specialFeatures[i].purchased;
    }
  }
  
  fullResets = data.fullResets || 0;
  criticalHits = data.criticalHits || 0;
  goldenTimeExperienced = data.goldenTimeExperienced || 0;
  rainbowCrits = data.rainbowCrits || 0;
  
  goldenTimeActive = data.goldenTimeActive || false;
  goldenTimeEnd = data.goldenTimeEnd || 0;
  
  if (data.minigames) {
    for (let i = 0; i < Math.min(minigames.length, data.minigames.length); i++) {
      minigames[i].unlocked = data.minigames[i].unlocked;
      minigames[i].completed = data.minigames[i].completed;
    }
  }
  
  if (data.challenges) {
    for (let i = 0; i < Math.min(challenges.length, data.challenges.length); i++) {
      challenges[i].active = data.challenges[i].active;
      challenges[i].completed = data.challenges[i].completed;
      challenges[i].progress = data.challenges[i].progress;
    }
  }
  
  currentEvent = data.currentEvent || null;
  eventEndTime = data.eventEndTime || 0;
  eventDuration = data.eventDuration || 0;
  eventActive = data.eventActive || false;
  eventRewards = data.eventRewards || [];
  
  if (data.prestigeShopItems) {
    for (let i = 0; i < Math.min(prestigeShopItems.length, data.prestigeShopItems.length); i++) {
      prestigeShopItems[i].unlocked = data.prestigeShopItems[i].unlocked;
      prestigeShopItems[i].purchased = data.prestigeShopItems[i].purchased;
    }
  }
  
  if (data.cosmicShopItems) {
    for (let i = 0; i < Math.min(cosmicShopItems.length, data.cosmicShopItems.length); i++) {
      cosmicShopItems[i].unlocked = data.cosmicShopItems[i].unlocked;
      cosmicShopItems[i].purchased = data.cosmicShopItems[i].purchased;
    }
  }
  
  if (data.ascensionShopItems) {
    for (let i = 0; i < Math.min(ascensionShopItems.length, data.ascensionShopItems.length); i++) {
      ascensionShopItems[i].unlocked = data.ascensionShopItems[i].unlocked;
      ascensionShopItems[i].purchased = data.ascensionShopItems[i].purchased;
    }
  }
  
  minigamesCompleted = data.minigamesCompleted || 0;
  researchCompleted = data.researchCompleted || 0;
  challengesCompleted = data.challengesCompleted || 0;
  eventsParticipated = data.eventsParticipated || 0;
  prestigeShopPurchases = data.prestigeShopPurchases || 0;
  cosmicShopPurchases = data.cosmicShopPurchases || 0;
  ascensionShopPurchases = data.ascensionShopPurchases || 0;
  elementalsUnlocked = data.elementalsUnlocked || 0;
  maxOfflineTime = data.maxOfflineTime || 0;
  
  criticalHitChance = data.criticalHitChance || 0.05;
  goldenTimeChance = data.goldenTimeChance || 0.0005;
  rainbowCritChance = data.rainbowCritChance || 0;
  
  if (data.lastSaved) {
    const now = Date.now();
    const offlineTime = Math.floor((now - data.lastSaved) / 1000);
    maxOfflineTime = Math.max(maxOfflineTime, offlineTime);
    
    if (offlineTime > 5) {
      const offlineEarnings = getAutoclickerEffectPerSec() * offlineTime;
      score += offlineEarnings;
      
      if (offlineEarnings > 0) {
        showNotification(`You earned ${formatNumber(offlineEarnings)} points while offline! (${formatTime(offlineTime)})`, '⏱️');
      }
    }
  }
  
  updateAll();
  renderAchievements();
}

function formatTime(seconds) {
  const days = Math.floor(seconds / 86400);
  seconds %= 86400;
  const hours = Math.floor(seconds / 3600);
  seconds %= 3600;
  const mins = Math.floor(seconds / 60);
  const secs = seconds % 60;
  
  let result = '';
  if (days > 0) result += `${days}d `;
  if (hours > 0) result += `${hours}h `;
  if (mins > 0) result += `${mins}m `;
  result += `${secs}s`;
  return result;
}

function saveGame() {
  const saveData = getSaveData();
  localStorage.setItem('skullClickerSaveV3.0', JSON.stringify(saveData));
  const now = new Date();
  document.getElementById('lastSavedInfo').textContent = `⏰ Last saved: ${now.toLocaleString()}`;
}

function loadGame() {
  const saveData = localStorage.getItem('skullClickerSaveV3.0');
  if (saveData) {
    try {
      setSaveData(JSON.parse(saveData));
      showNotification('Game loaded successfully!', '📁');
      return true;
    } catch (e) {
      console.error('Failed to parse save data:', e);
      showNotification('Failed to load save data!', '❌');
    }
  } else {
    showNotification('No save data found!', '❌');
  }
  return false;
}

function exportSave() {
  const saveData = getSaveData();
  const saveString = JSON.stringify(saveData);
  const blob = new Blob([saveString], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  
  const a = document.createElement('a');
  a.href = url;
  a.download = 'skull_clicker_ultimate_save.json';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  showNotification('Save data exported!', '📤');
}

function importSave() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json';
  
  input.onchange = e => {
    const file = e.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = event => {
      try {
        const saveData = JSON.parse(event.target.result);
        setSaveData(saveData);
        showNotification('Save data imported successfully!', '📥');
        autoSave();
      } catch (err) {
        console.error('Failed to import save:', err);
        showNotification('Invalid save file!', '❌');
      }
    };
    reader.readAsText(file);
  };
  
  input.click();
}

function resetGame() {
  if (confirm('🚨 Are you sure you want to reset ALL game progress? This cannot be undone! 🚨')) {
    fullResets++;
    
    // Reset all variables to default
    score = 0;
    baseMultiplier = 1;
    factoryLevel = 0;
    bankLevel = 0;
    hotelLevel = 0;
    shopLevel = 0;
    autoclickerLevel = 0;
    prestigeLevel = 0;
    prestigeCost = prestigeBaseCost;
    ascensionLevel = 0;
    ascensionCost = ascensionBaseCost;
    cosmicLevel = 0;
    cosmicCost = cosmicBaseCost;
    clicks = 0;
    upgradesUnlocked = 3;
    criticalHits = 0;
    goldenTimeExperienced = 0;
    rainbowCrits = 0;
    
    criticalHitChance = 0.05;
    goldenTimeChance = 0.0005;
    rainbowCritChance = 0;
    
    for (let i = 0; i < upgrades.length; i++) {
      upgrades[i].cost = baseUpgradeCosts[i];
    }
    
    achievements.forEach(a => a.unlocked = false);
    
    researchProjects.forEach(r => {
      r.unlocked = r.id === 'upgrade_research_1' || r.id === 'critical_research';
      r.completed = false;
    });
    
    automationFeatures.forEach(f => {
      f.unlocked = false;
      f.level = 0;
      f.active = false;
    });
    
    multiplierFeatures.forEach(f => {
      f.unlocked = f.id === 'click_multiplier';
      f.level = 0;
    });
    
    specialFeatures.forEach(f => {
      f.unlocked = f.id === 'particle_effects';
      f.purchased = false;
    });
    
    minigames.forEach(m => {
      m.unlocked = m.id === 'click_frenzy';
      m.completed = false;
    });
    
    challenges.forEach(c => {
      c.active = false;
      c.completed = false;
      c.progress = 0;
    });
    
    prestigeShopItems.forEach(i => {
      i.unlocked = i.id === 'prestige_crit';
      i.purchased = false;
    });
    
    cosmicShopItems.forEach(i => {
      i.unlocked = i.id === 'cosmic_crit';
      i.purchased = false;
    });
    
    ascensionShopItems.forEach(i => {
      i.unlocked = i.id === 'ascension_ultimate';
      i.purchased = false;
    });
    
    minigamesCompleted = 0;
    researchCompleted = 0;
    challengesCompleted = 0;
    eventsParticipated = 0;
    prestigeShopPurchases = 0;
    cosmicShopPurchases = 0;
    ascensionShopPurchases = 0;
    elementalsUnlocked = 0;
    maxOfflineTime = 0;
    
    currentEvent = null;
    eventEndTime = 0;
    eventDuration = 0;
    eventActive = false;
    eventRewards = [];
    
    goldenTimeActive = false;
    goldenTimeEnd = 0;
    
    updateAll();
    renderAchievements();
    autoSave();
    showNotification('🔄 Game has been completely reset! 🔄', '♻️');
    checkAchievements();
  }
}

function autoSave() {
  saveGame();
}

setInterval(autoSave, 30000);

document.getElementById('saveBtn').addEventListener('click', saveGame);
document.getElementById('loadBtn').addEventListener('click', loadGame);
document.getElementById('exportBtn').addEventListener('click', exportSave);
document.getElementById('importBtn').addEventListener('click', importSave);
document.getElementById('resetBtn').addEventListener('click', resetGame);

// ----- Initialization -----
function initGame() {
  if (!loadGame()) {
    updateAll();
    renderAchievements();
    renderResearch();
    renderUpgrades();
    renderAutomation();
    renderMultipliers();
    renderSpecialFeatures();
    renderPrestigeShop();
    renderCosmicShop();
    renderAscensionShop();
    renderMinigames();
    renderChallenges();
    renderEvent();
    
    setTimeout(() => {
      showNotification('🎉 Welcome to Skull Clicker Ultimate Enhanced! Complete research to unlock new upgrades! 🎉', '💀');
    }, 1000);
  }
}

window.addEventListener('load', initGame);

document.addEventListener('keydown', (e) => {
  if (e.key === ' ') {
    e.preventDefault();
    document.getElementById('mainBtn').click();
  }
  if (e.ctrlKey && e.key === 's') {
    e.preventDefault();
    saveGame();
  }
  if (e.ctrlKey && e.key === 'l') {
    e.preventDefault();
    loadGame();
  }
});
</script>
</body>
</html>
