<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: white;
            overflow: hidden;
            touch-action: manipulation;
        }

        .camera-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .video-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 10;
        }

        .camera-grid {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.3;
            display: none;
        }

        .camera-grid.active {
            display: block;
        }

        .grid-line {
            position: absolute;
            background: white;
        }

        .grid-line.horizontal {
            height: 1px;
            left: 0;
            right: 0;
        }

        .grid-line.vertical {
            width: 1px;
            top: 0;
            bottom: 0;
        }

        .controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            z-index: 20;
        }

        .controls-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .top-controls {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: linear-gradient(rgba(0,0,0,0.8), transparent);
            z-index: 20;
        }

        .control-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .capture-btn {
            width: 80px;
            height: 80px;
            background: white;
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .capture-btn:hover {
            transform: scale(1.05);
        }

        .capture-btn:active {
            transform: scale(0.95);
            background: #f0f0f0;
        }

        .capture-btn.recording {
            background: #ff4444;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* UPDATED: Mode container centered horizontally */
        .mode-container {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
        }

        .mode-selector {
            display: flex;
            background: rgba(255,255,255,0.1);
            border-radius: 25px;
            padding: 5px;
            backdrop-filter: blur(10px);
        }

        .mode-btn {
            background: none;
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .mode-btn.active {
            background: rgba(255,255,255,0.3);
        }

        .gallery-preview {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            border: 2px solid rgba(255,255,255,0.3);
            cursor: pointer;
            overflow: hidden;
            background: rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .gallery-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .flash-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 30;
        }

        .flash-overlay.active {
            animation: flash 0.2s ease-out;
        }

        @keyframes flash {
            0% { opacity: 0; }
            50% { opacity: 0.8; }
            100% { opacity: 0; }
        }

        /* UPDATED: Zoom controls moved to right side */
        .zoom-controls {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 15;
        }

        /* UPDATED: Smaller zoom buttons with just numbers */
        .zoom-btn {
            width: 32px;
            height: 32px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
        }

        .zoom-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        /* UPDATED: Green color for active zoom button */
        .zoom-btn.active {
            background: #4CAF50;
            color: white;
            font-weight: bold;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }

        .error-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            z-index: 40;
        }

        .photos-grid {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: black;
            z-index: 50;
            padding: 20px;
            overflow-y: auto;
            display: none;
        }

        .photos-grid.active {
            display: block;
        }

        .photos-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .photos-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }

        .photo-item {
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            position: relative;
        }

        .photo-item img,
        .photo-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-actions {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .photo-item:hover .photo-actions {
            opacity: 1;
        }

        .photo-action-btn {
            background: rgba(0, 0, 0, 0.7);
            border: none;
            border-radius: 4px;
            color: white;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .photo-action-btn:hover {
            background: rgba(255, 0, 0, 0.8);
            transform: scale(1.1);
        }

        .zoom-indicator {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: rgba(0,0,0,0.7);
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 600;
        }

        .top-right-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 20;
        }

        .confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .confirm-modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .confirm-content {
            background: #222;
            padding: 24px;
            border-radius: 12px;
            max-width: 300px;
            text-align: center;
        }

        .confirm-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            justify-content: center;
        }

        .confirm-btn {
            padding: 8px 20px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .confirm-btn.delete {
            background: #ff4444;
            color: white;
        }

        .confirm-btn.cancel {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        @media (max-width: 768px) {
            .control-btn {
                width: 45px;
                height: 45px;
                font-size: 16px;
            }

            .capture-btn {
                width: 70px;
                height: 70px;
            }

            .controls {
                padding: 15px;
            }

            .zoom-btn {
                width: 28px;
                height: 28px;
                font-size: 11px;
            }

            .mode-btn {
                padding: 6px 12px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="camera-container">
        <div class="video-container">
            <video id="video" autoplay muted playsinline></video>
            <canvas id="canvas" style="display: none;"></canvas>
            
            <div class="camera-overlay">
                <div class="camera-grid" id="grid">
                    <div class="grid-line horizontal" style="top: 33.33%;"></div>
                    <div class="grid-line horizontal" style="top: 66.66%;"></div>
                    <div class="grid-line vertical" style="left: 33.33%;"></div>
                    <div class="grid-line vertical" style="left: 66.66%;"></div>
                </div>
            </div>

            <div class="flash-overlay" id="flashOverlay"></div>

            <!-- UPDATED: Zoom controls on right side -->
            <div class="zoom-controls">
                <button class="zoom-btn" data-zoom="1">1</button>
                <button class="zoom-btn" data-zoom="2">2</button>
                <button class="zoom-btn" data-zoom="4">4</button>
                <button class="zoom-btn" data-zoom="8">8</button>
                <button class="zoom-btn" data-zoom="16">16</button>
                <button class="zoom-btn" data-zoom="32">32</button>
            </div>
        </div>

        <!-- Mode selector now centered horizontally -->
        <div class="mode-container">
            <div class="mode-selector">
                <button class="mode-btn active" data-mode="photo">PHOTO</button>
                <button class="mode-btn" data-mode="video">VIDEO</button>
            </div>
        </div>

        <!-- Top right controls (only grid button now) -->
        <div class="top-right-controls">
            <button class="control-btn" id="gridBtn" title="Grid">‚äû</button>
        </div>

        <div class="controls">
            <div class="controls-row">
                <div class="gallery-preview" id="galleryBtn">
                    üì∑
                </div>
                
                <button class="capture-btn" id="captureBtn"></button>
                
                <button class="control-btn" id="switchBtn" title="Switch Camera">üîÑ</button>
            </div>
        </div>
    </div>

    <div class="photos-grid" id="photosGrid">
        <div class="photos-header">
            <h2>Photos</h2>
            <button class="control-btn" id="closeGallery">‚úï</button>
        </div>
        <div class="photos-container" id="photosContainer"></div>
    </div>

    <!-- Delete confirmation modal -->
    <div class="confirm-modal" id="deleteModal">
        <div class="confirm-content">
            <h3>Delete Photo?</h3>
            <p>Are you sure you want to delete this photo? This action cannot be undone.</p>
            <div class="confirm-buttons">
                <button class="confirm-btn delete" id="confirmDelete">Delete</button>
                <button class="confirm-btn cancel" id="cancelDelete">Cancel</button>
            </div>
        </div>
    </div>

    <div class="error-message" id="errorMessage" style="display: none;">
        <h3>Camera Access Required</h3>
        <p>Please allow camera access to use this app</p>
        <button onclick="requestCameraAccess()">Try Again</button>
    </div>

    <script>
        class CameraApp {
            constructor() {
                this.video = document.getElementById('video');
                this.canvas = document.getElementById('canvas');
                this.captureBtn = document.getElementById('captureBtn');
                this.switchBtn = document.getElementById('switchBtn');
                this.gridBtn = document.getElementById('gridBtn');
                this.galleryBtn = document.getElementById('galleryBtn');
                this.flashOverlay = document.getElementById('flashOverlay');
                this.photosGrid = document.getElementById('photosGrid');
                this.photosContainer = document.getElementById('photosContainer');
                this.closeGallery = document.getElementById('closeGallery');
                this.errorMessage = document.getElementById('errorMessage');
                this.zoomButtons = document.querySelectorAll('.zoom-btn');
                this.deleteModal = document.getElementById('deleteModal');
                this.confirmDeleteBtn = document.getElementById('confirmDelete');
                this.cancelDeleteBtn = document.getElementById('cancelDelete');

                this.stream = null;
                this.currentCamera = 'user';
                this.gridVisible = false;
                this.currentMode = 'photo';
                this.isRecording = false;
                this.mediaRecorder = null;
                this.photos = JSON.parse(localStorage.getItem('cameraPhotos') || '[]');
                this.currentZoom = 1;
                // UPDATED: Added 32x zoom level
                this.zoomLevels = [1, 2, 4, 8, 16, 32];
                this.photoToDelete = null;

                this.init();
            }

            async init() {
                try {
                    await this.requestCameraAccess();
                    this.setupEventListeners();
                    this.updateGalleryPreview();
                    this.setupTouchGestures();
                    this.setActiveZoomButton(1);
                } catch (error) {
                    this.showError('Failed to access camera: ' + error.message);
                }
            }

            async requestCameraAccess() {
                try {
                    const constraints = {
                        video: {
                            facingMode: this.currentCamera,
                            width: { ideal: 1920 },
                            height: { ideal: 1080 }
                        },
                        audio: true
                    };

                    this.stream = await navigator.mediaDevices.getUserMedia(constraints);
                    this.video.srcObject = this.stream;
                    this.errorMessage.style.display = 'none';
                } catch (error) {
                    throw new Error('Camera access denied or not available');
                }
            }

            setupEventListeners() {
                // Capture button
                this.captureBtn.addEventListener('click', () => {
                    if (this.currentMode === 'photo') {
                        this.takePhoto();
                    } else if (this.currentMode === 'video') {
                        this.toggleVideoRecording();
                    }
                });

                // Switch camera
                this.switchBtn.addEventListener('click', () => this.switchCamera());

                // Grid toggle
                this.gridBtn.addEventListener('click', () => this.toggleGrid());

                // Gallery
                this.galleryBtn.addEventListener('click', () => this.openGallery());
                this.closeGallery.addEventListener('click', () => this.closeGalleryView());

                // Mode selection
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.switchMode(e.target.dataset.mode);
                    });
                });

                // Zoom buttons
                this.zoomButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const zoom = parseInt(e.target.dataset.zoom);
                        this.setZoom(zoom);
                        this.setActiveZoomButton(zoom);
                    });
                });

                // Delete confirmation
                this.confirmDeleteBtn.addEventListener('click', () => this.deletePhotoConfirmed());
                this.cancelDeleteBtn.addEventListener('click', () => this.cancelDelete());

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    switch(e.code) {
                        case 'Space':
                            e.preventDefault();
                            this.captureBtn.click();
                            break;
                        case 'KeyG':
                            this.toggleGrid();
                            break;
                        case 'Digit1':
                        case 'Digit2':
                        case 'Digit3':
                        case 'Digit4':
                        case 'Digit5':
                        case 'Digit6':
                            const index = parseInt(e.key) - 1;
                            if (index < this.zoomLevels.length) {
                                const zoom = this.zoomLevels[index];
                                this.setZoom(zoom);
                                this.setActiveZoomButton(zoom);
                            }
                            break;
                    }
                });

                this.updateTime();
                setInterval(() => this.updateTime(), 1000);
            }

            setActiveZoomButton(zoom) {
                this.zoomButtons.forEach(btn => {
                    const btnZoom = parseInt(btn.dataset.zoom);
                    // UPDATED: Green color for active zoom button
                    if (btnZoom === zoom) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            }

            setupTouchGestures() {
                let startDistance = 0;
                let startZoom = 1;

                this.video.addEventListener('touchstart', (e) => {
                    if (e.touches.length === 2) {
                        startDistance = this.getDistance(e.touches[0], e.touches[1]);
                        startZoom = this.currentZoom;
                    }
                });

                this.video.addEventListener('touchmove', (e) => {
                    if (e.touches.length === 2) {
                        e.preventDefault();
                        const currentDistance = this.getDistance(e.touches[0], e.touches[1]);
                        const scale = currentDistance / startDistance;
                        let newZoom = Math.min(32, Math.max(1, startZoom * scale));
                        
                        // Snap to nearest zoom level
                        let closestZoom = 1;
                        let minDiff = Infinity;
                        this.zoomLevels.forEach(level => {
                            const diff = Math.abs(level - newZoom);
                            if (diff < minDiff) {
                                minDiff = diff;
                                closestZoom = level;
                            }
                        });
                        
                        this.setZoom(closestZoom);
                        this.setActiveZoomButton(closestZoom);
                    }
                });

                // Double tap to switch camera
                let lastTap = 0;
                this.video.addEventListener('touchend', (e) => {
                    const currentTime = new Date().getTime();
                    const tapLength = currentTime - lastTap;
                    if (tapLength < 500 && tapLength > 0) {
                        this.switchCamera();
                    }
                    lastTap = currentTime;
                });
            }

            getDistance(touch1, touch2) {
                return Math.sqrt(
                    Math.pow(touch2.clientX - touch1.clientX, 2) +
                    Math.pow(touch2.clientY - touch1.clientY, 2)
                );
            }

            setZoom(zoom) {
                this.currentZoom = zoom;
                if (this.stream) {
                    const track = this.stream.getVideoTracks()[0];
                    if (track.getCapabilities && track.getCapabilities().zoom) {
                        track.applyConstraints({
                            advanced: [{ zoom: zoom }]
                        });
                    } else {
                        // Fallback: CSS transform
                        this.video.style.transform = `scale(${zoom})`;
                    }
                }
            }

            async takePhoto() {
                this.flashOverlay.classList.add('active');
                setTimeout(() => {
                    this.flashOverlay.classList.remove('active');
                }, 200);

                const context = this.canvas.getContext('2d');
                this.canvas.width = this.video.videoWidth;
                this.canvas.height = this.video.videoHeight;
                
                // Apply zoom for photo capture
                context.save();
                context.translate(this.canvas.width/2, this.canvas.height/2);
                context.scale(this.currentZoom, this.currentZoom);
                context.translate(-this.canvas.width/2, -this.canvas.height/2);
                
                context.drawImage(this.video, 0, 0);
                context.restore();
                
                const dataURL = this.canvas.toDataURL('image/jpeg', 0.9);
                const photo = {
                    id: Date.now(),
                    dataURL: dataURL,
                    timestamp: new Date().toISOString(),
                    zoom: this.currentZoom
                };

                this.photos.unshift(photo);
                localStorage.setItem('cameraPhotos', JSON.stringify(this.photos));
                this.updateGalleryPreview();

                this.captureBtn.style.transform = 'scale(0.9)';
                setTimeout(() => {
                    this.captureBtn.style.transform = 'scale(1)';
                }, 100);
            }

            async toggleVideoRecording() {
                if (!this.isRecording) {
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({
                            video: { facingMode: this.currentCamera },
                            audio: true
                        });

                        this.mediaRecorder = new MediaRecorder(stream);
                        const chunks = [];

                        this.mediaRecorder.ondataavailable = (e) => {
                            if (e.data.size > 0) {
                                chunks.push(e.data);
                            }
                        };

                        this.mediaRecorder.onstop = () => {
                            const blob = new Blob(chunks, { type: 'video/webm' });
                            const url = URL.createObjectURL(blob);
                            const video = {
                                id: Date.now(),
                                dataURL: url,
                                timestamp: new Date().toISOString(),
                                type: 'video',
                                zoom: this.currentZoom
                            };

                            this.photos.unshift(video);
                            localStorage.setItem('cameraPhotos', JSON.stringify(this.photos));
                            this.updateGalleryPreview();
                        };

                        this.mediaRecorder.start();
                        this.isRecording = true;
                        this.captureBtn.classList.add('recording');
                    } catch (error) {
                        console.error('Error starting video recording:', error);
                    }
                } else {
                    this.mediaRecorder.stop();
                    this.isRecording = false;
                    this.captureBtn.classList.remove('recording');
                }
            }

            async switchCamera() {
                this.currentCamera = this.currentCamera === 'user' ? 'environment' : 'user';
                
                if (this.stream) {
                    this.stream.getTracks().forEach(track => track.stop());
                }

                try {
                    await this.requestCameraAccess();
                    // Reset zoom when switching cameras
                    this.setZoom(1);
                    this.setActiveZoomButton(1);
                } catch (error) {
                    this.showError('Failed to switch camera');
                }
            }

            toggleGrid() {
                this.gridVisible = !this.gridVisible;
                const grid = document.getElementById('grid');
                grid.classList.toggle('active', this.gridVisible);
                this.gridBtn.style.background = this.gridVisible ? 
                    'rgba(255,255,255,0.4)' : 'rgba(255,255,255,0.2)';
            }

            switchMode(mode) {
                this.currentMode = mode;
                
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-mode="${mode}"]`).classList.add('active');

                if (mode === 'video') {
                    this.captureBtn.style.borderRadius = '12px';
                } else {
                    this.captureBtn.style.borderRadius = '50%';
                }
            }

            updateGalleryPreview() {
                if (this.photos.length > 0) {
                    const latestPhoto = this.photos[0];
                    this.galleryBtn.innerHTML = `<img src="${latestPhoto.dataURL}" alt="Latest photo">`;
                } else {
                    this.galleryBtn.innerHTML = 'üì∑';
                }
            }

            openGallery() {
                this.photosGrid.classList.add('active');
                this.renderPhotos();
            }

            closeGalleryView() {
                this.photosGrid.classList.remove('active');
            }

            renderPhotos() {
                this.photosContainer.innerHTML = this.photos.map(photo => 
                    `<div class="photo-item" data-id="${photo.id}">
                        ${photo.type === 'video' ? 
                            `<video src="${photo.dataURL}" muted></video>` :
                            `<img src="${photo.dataURL}" alt="Photo">`
                        }
                        <div class="zoom-indicator">${photo.zoom || 1}x</div>
                        <div class="photo-actions">
                            <button class="photo-action-btn delete-btn" title="Delete">üóëÔ∏è</button>
                        </div>
                    </div>`
                ).join('');

                // Add delete event listeners
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const photoItem = e.target.closest('.photo-item');
                        const photoId = parseInt(photoItem.dataset.id);
                        this.showDeleteConfirm(photoId);
                    });
                });

                // Add click to view
                document.querySelectorAll('.photo-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('photo-action-btn')) {
                            const photoId = parseInt(item.dataset.id);
                            this.viewPhoto(photoId);
                        }
                    });
                });
            }

            showDeleteConfirm(photoId) {
                this.photoToDelete = photoId;
                this.deleteModal.classList.add('active');
            }

            deletePhotoConfirmed() {
                if (this.photoToDelete) {
                    this.photos = this.photos.filter(photo => photo.id !== this.photoToDelete);
                    localStorage.setItem('cameraPhotos', JSON.stringify(this.photos));
                    this.renderPhotos();
                    this.updateGalleryPreview();
                    this.photoToDelete = null;
                }
                this.deleteModal.classList.remove('active');
            }

            cancelDelete() {
                this.photoToDelete = null;
                this.deleteModal.classList.remove('active');
            }

            viewPhoto(photoId) {
                const photo = this.photos.find(p => p.id == photoId);
                if (photo) {
                    const newWindow = window.open();
                    newWindow.document.write(`
                        <html>
                            <head><title>Photo View</title></head>
                            <body style="margin:0; background:#000; display:flex; justify-content:center; align-items:center; height:100vh;">
                                ${photo.type === 'video' ? 
                                    `<video src="${photo.dataURL}" controls autoplay style="max-width:100%; max-height:100%;"></video>` :
                                    `<img src="${photo.dataURL}" style="max-width:100%; max-height:100%;" alt="Photo">`
                                }
                            </body>
                        </html>
                    `);
                }
            }

            updateTime() {
                // Time update logic if needed
            }

            showError(message) {
                this.errorMessage.querySelector('p').textContent = message;
                this.errorMessage.style.display = 'block';
            }
        }

        let cameraApp;
        
        window.addEventListener('load', () => {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                cameraApp = new CameraApp();
            } else {
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('errorMessage').querySelector('p').textContent = 
                    'Camera not supported in this browser';
            }
        });

        function requestCameraAccess() {
            if (cameraApp) {
                cameraApp.requestCameraAccess();
            }
        }

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(console.error);
        }
    </script>
</body>
</html>
